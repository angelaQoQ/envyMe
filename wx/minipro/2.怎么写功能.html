<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>2.怎么写功能? | 用心</title>
    <meta name="description" content="活着">
    <link rel="icon" href="./press_avatar.png">
    
    <link rel="preload" href="/assets/css/0.styles.18be6571.css" as="style"><link rel="preload" href="/assets/js/app.314208ec.js" as="script"><link rel="preload" href="/assets/js/2.3dbe4ac7.js" as="script"><link rel="preload" href="/assets/js/5.38464c3f.js" as="script"><link rel="prefetch" href="/assets/js/10.09fa1052.js"><link rel="prefetch" href="/assets/js/11.d4f3cc01.js"><link rel="prefetch" href="/assets/js/12.845c0d45.js"><link rel="prefetch" href="/assets/js/13.3eea8c07.js"><link rel="prefetch" href="/assets/js/14.680482c3.js"><link rel="prefetch" href="/assets/js/15.0e1a4de8.js"><link rel="prefetch" href="/assets/js/16.c2b57ca6.js"><link rel="prefetch" href="/assets/js/17.f6d53abe.js"><link rel="prefetch" href="/assets/js/18.32518103.js"><link rel="prefetch" href="/assets/js/19.27feb172.js"><link rel="prefetch" href="/assets/js/20.06be6d6e.js"><link rel="prefetch" href="/assets/js/21.9e865467.js"><link rel="prefetch" href="/assets/js/22.630cda10.js"><link rel="prefetch" href="/assets/js/23.a9756b8d.js"><link rel="prefetch" href="/assets/js/24.eb4d423b.js"><link rel="prefetch" href="/assets/js/25.ab6e4013.js"><link rel="prefetch" href="/assets/js/26.6ef779c7.js"><link rel="prefetch" href="/assets/js/27.d15ed41b.js"><link rel="prefetch" href="/assets/js/28.086a9083.js"><link rel="prefetch" href="/assets/js/29.31e7789f.js"><link rel="prefetch" href="/assets/js/3.788b749c.js"><link rel="prefetch" href="/assets/js/30.78afe3a4.js"><link rel="prefetch" href="/assets/js/31.6fa1a3fc.js"><link rel="prefetch" href="/assets/js/32.31b3c7c5.js"><link rel="prefetch" href="/assets/js/33.3bd402a1.js"><link rel="prefetch" href="/assets/js/34.26464d62.js"><link rel="prefetch" href="/assets/js/35.4cd98e92.js"><link rel="prefetch" href="/assets/js/36.23ac981b.js"><link rel="prefetch" href="/assets/js/37.0b28d024.js"><link rel="prefetch" href="/assets/js/38.1fe985a9.js"><link rel="prefetch" href="/assets/js/39.6822d10c.js"><link rel="prefetch" href="/assets/js/4.14f39196.js"><link rel="prefetch" href="/assets/js/40.0ed7188a.js"><link rel="prefetch" href="/assets/js/41.6f24726d.js"><link rel="prefetch" href="/assets/js/42.54e402eb.js"><link rel="prefetch" href="/assets/js/43.54835e7c.js"><link rel="prefetch" href="/assets/js/44.df4c1b7e.js"><link rel="prefetch" href="/assets/js/45.0873fde0.js"><link rel="prefetch" href="/assets/js/46.4796fd27.js"><link rel="prefetch" href="/assets/js/47.e9efc34d.js"><link rel="prefetch" href="/assets/js/48.6a329478.js"><link rel="prefetch" href="/assets/js/49.173f63c6.js"><link rel="prefetch" href="/assets/js/50.864c3c6f.js"><link rel="prefetch" href="/assets/js/51.6a00893c.js"><link rel="prefetch" href="/assets/js/52.48b20bcd.js"><link rel="prefetch" href="/assets/js/6.e83a0ec3.js"><link rel="prefetch" href="/assets/js/7.1bd9d7d8.js"><link rel="prefetch" href="/assets/js/8.84adaaaa.js"><link rel="prefetch" href="/assets/js/9.0aada2c5.js">
    <link rel="stylesheet" href="/assets/css/0.styles.18be6571.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">用心</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Js</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Js_basis/" class="nav-link">Js基础</a></li><li class="dropdown-item"><!----> <a href="/Js_Advance/" class="nav-link">Js高级</a></li><li class="dropdown-item"><!----> <a href="/Js_bugs/" class="nav-link">Js问题整理</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Vue全家桶</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue/" class="nav-link">vue</a></li><li class="dropdown-item"><!----> <a href="/vue-router/" class="nav-link">vue-router</a></li><li class="dropdown-item"><!----> <a href="/vuex/" class="nav-link">vuex</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">小程序</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/wx/minipro/1.拿什么写小程序.html" class="nav-link">小程序</a></li><li class="dropdown-item"><!----> <a href="/wx/minipub/" class="nav-link">公众号</a></li><li class="dropdown-item"><!----> <a href="/wx/wxgm/" class="nav-link">小游戏</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Js</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Js_basis/" class="nav-link">Js基础</a></li><li class="dropdown-item"><!----> <a href="/Js_Advance/" class="nav-link">Js高级</a></li><li class="dropdown-item"><!----> <a href="/Js_bugs/" class="nav-link">Js问题整理</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Vue全家桶</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue/" class="nav-link">vue</a></li><li class="dropdown-item"><!----> <a href="/vue-router/" class="nav-link">vue-router</a></li><li class="dropdown-item"><!----> <a href="/vuex/" class="nav-link">vuex</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">小程序</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/wx/minipro/1.拿什么写小程序.html" class="nav-link">小程序</a></li><li class="dropdown-item"><!----> <a href="/wx/minipub/" class="nav-link">公众号</a></li><li class="dropdown-item"><!----> <a href="/wx/wxgm/" class="nav-link">小游戏</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Js</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue-Router</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vuex</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>小程序</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/wx/minipro/4.深入理解小程序.html" class="sidebar-link">0.一小时小程序概述</a></li><li><a href="/wx/minipro/1.拿什么写小程序.html" class="sidebar-link">1.搭建页面结构</a></li><li><a href="/wx/minipro/2.怎么写功能.html" class="active sidebar-link">2.怎么写功能?</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/wx/minipro/2.怎么写功能.html#_0-提前了解几个容易混淆的id和key" class="sidebar-link">0.提前了解几个容易混淆的id和key</a></li><li class="sidebar-sub-header"><a href="/wx/minipro/2.怎么写功能.html#_0-开发和上线前的配置" class="sidebar-link">0.开发和上线前的配置</a></li><li class="sidebar-sub-header"><a href="/wx/minipro/2.怎么写功能.html#_1-搭建基本项目结构目录" class="sidebar-link">1.搭建基本项目结构目录</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/wx/minipro/2.怎么写功能.html#和vue学习的区别" class="sidebar-link">和Vue学习的区别</a></li><li class="sidebar-sub-header"><a href="/wx/minipro/2.怎么写功能.html#_1-app-json" class="sidebar-link">1.app.json</a></li><li class="sidebar-sub-header"><a href="/wx/minipro/2.怎么写功能.html#_2-app-js" class="sidebar-link">2.app.js</a></li><li class="sidebar-sub-header"><a href="/wx/minipro/2.怎么写功能.html#_3-app-wxss" class="sidebar-link">3.app.wxss</a></li></ul></li><li class="sidebar-sub-header"><a href="/wx/minipro/2.怎么写功能.html#_2-微信wxs模块化" class="sidebar-link">2.微信wxs模块化</a></li><li class="sidebar-sub-header"><a href="/wx/minipro/2.怎么写功能.html#_3-常用api-如支付-本地存储等功能" class="sidebar-link">3.常用API(如支付,本地存储等功能)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/wx/minipro/2.怎么写功能.html#_3-1-页面跳转-路由" class="sidebar-link">3.1 页面跳转(路由)</a></li><li class="sidebar-sub-header"><a href="/wx/minipro/2.怎么写功能.html#_3-2-定时器" class="sidebar-link">3.2 定时器</a></li><li class="sidebar-sub-header"><a href="/wx/minipro/2.怎么写功能.html#_3-3-网络" class="sidebar-link">3.3 网络</a></li><li class="sidebar-sub-header"><a href="/wx/minipro/2.怎么写功能.html#_3-4-页面展示效果和基本交互" class="sidebar-link">3.4 页面展示效果和基本交互</a></li></ul></li><li class="sidebar-sub-header"><a href="/wx/minipro/2.怎么写功能.html#_4-数据缓存" class="sidebar-link">4.数据缓存</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/wx/minipro/2.怎么写功能.html#设置缓存" class="sidebar-link">设置缓存</a></li><li class="sidebar-sub-header"><a href="/wx/minipro/2.怎么写功能.html#清除缓存" class="sidebar-link">清除缓存</a></li><li class="sidebar-sub-header"><a href="/wx/minipro/2.怎么写功能.html#获取缓存" class="sidebar-link">获取缓存</a></li></ul></li><li class="sidebar-sub-header"><a href="/wx/minipro/2.怎么写功能.html#_5-定位" class="sidebar-link">5.定位</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/wx/minipro/2.怎么写功能.html#前提定位权限获取" class="sidebar-link">前提定位权限获取</a></li><li class="sidebar-sub-header"><a href="/wx/minipro/2.怎么写功能.html#获取用户定位-wx-getlocation" class="sidebar-link">获取用户定位: wx.getLocation({})</a></li><li class="sidebar-sub-header"><a href="/wx/minipro/2.怎么写功能.html#定位追踪" class="sidebar-link">定位追踪</a></li></ul></li><li class="sidebar-sub-header"><a href="/wx/minipro/2.怎么写功能.html#_6-媒体" class="sidebar-link">6.媒体</a></li><li class="sidebar-sub-header"><a href="/wx/minipro/2.怎么写功能.html#_7-登录-支付等3方接口" class="sidebar-link">7.登录,支付等3方接口</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/wx/minipro/2.怎么写功能.html#登录-wx-login" class="sidebar-link">登录 wx.Login({})</a></li><li class="sidebar-sub-header"><a href="/wx/minipro/2.怎么写功能.html#授权" class="sidebar-link">授权</a></li><li class="sidebar-sub-header"><a href="/wx/minipro/2.怎么写功能.html#支付-wx-requestpayment" class="sidebar-link">支付 wx.requestPayment({})</a></li><li class="sidebar-sub-header"><a href="/wx/minipro/2.怎么写功能.html#生物认证" class="sidebar-link">生物认证</a></li><li class="sidebar-sub-header"><a href="/wx/minipro/2.怎么写功能.html#小程序跳转" class="sidebar-link">小程序跳转</a></li><li class="sidebar-sub-header"><a href="/wx/minipro/2.怎么写功能.html#微信登录" class="sidebar-link">微信登录</a></li></ul></li><li class="sidebar-sub-header"><a href="/wx/minipro/2.怎么写功能.html#_8-画布" class="sidebar-link">8.画布</a></li></ul></li><li><a href="/wx/minipro/3.项目叨逼叨.html" class="sidebar-link">项目叨逼叨</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_2-怎么写功能"><a href="#_2-怎么写功能" aria-hidden="true" class="header-anchor">#</a> 2.怎么写功能?</h1> <ul><li>会了标签,写出了结构之后,怎么写功能?</li> <li>'小程序s, wxs语法了解一下~'</li> <li>贼简单,比Vue还简单</li></ul> <h2 id="_0-提前了解几个容易混淆的id和key"><a href="#_0-提前了解几个容易混淆的id和key" aria-hidden="true" class="header-anchor">#</a> 0.提前了解几个容易混淆的id和key</h2> <ul><li><p>openid: 微信用户唯一标识</p></li> <li><p>业务侧用户id: 在开发者服务器上不同用户的身份id</p> <ul><li>美团内部会把小程序使用者的用户名密码与使用者的openid进行绑定</li> <li>开发者后台通过校验用户名密码就拿到了业务侧的用户身份id，通过code到微信服务器获取微信侧的用户身份openid</li> <li>绑定后，小程序在下次需要用户登录的时候就可以不需要输入账号密码,通过用户的openid就可以拿到业务侧id,处理业务</li></ul></li> <li><p>code: 用户登录微信服务器返回的临时识别码,时效性5分钟</p></li> <li><p>unionid: 用户在微信开放平台的唯一标识符</p></li> <li><p>session_key: <strong>微信服务器</strong> 给 <strong>开发者服务器</strong>的身份凭证</p> <ul><li>开发者可以使用session_key请求微信服务器的相关接口</li></ul></li> <li><p>session_id: <strong>开发者服务器</strong> 和 <strong>小程序的</strong> 业务登录凭证</p> <ul><li>微信侧返回的session_key是开发者服务器和微信服务器的会话密钥</li> <li>同样 开发者服务器 和 开发者的小程序 应该也有会话密钥</li> <li>用户登录成功之后，<strong>开发者服务器</strong>需要生成会话密钥SessionId, 在服务端保持SessionId对应的用户身份信息，同时把SessionId返回给小程序</li> <li>小程序后续发起的请求中携带上SessionId，开发者服务器就可以通过服务器端的Session信息查询到当前登录用户的身份，这样我们就不需要每次都重新获取code，省去了很多通信消耗</li> <li>**使用:**利用本地数据缓存的能力把SessionId存储起来，以便在它还没过期的时候能重复利用，以提高通信的性能</li></ul></li></ul> <h2 id="_0-开发和上线前的配置"><a href="#_0-开发和上线前的配置" aria-hidden="true" class="header-anchor">#</a> 0.开发和上线前的配置</h2> <ol><li>登录mp.weixin.qq.com，在设置, 开发设置里配置request的服务器域名，同时TLS版本需要支持1.2及以上</li> <li>开发者工具需要勾选不校验可信域名；小程序开发版和体验版需要打开调试模式。</li> <li>由于小程序在启动时会做异步更新版本检测，所以旧版本很快就不会有人访问到，但是依旧存在这种情况。</li> <li>注意id不是指微信用户的微信号/密码等隐私信息，可以理解为id是微信用户在服务器的一个编号。</li> <li>如果小程序使用到Flex布局，并且需要兼容iOS8以下系统时，请检查上传小程序包时，开发者工具是否已经开启“上传代码时样式自动补全”</li> <li>小程序使用的服务器接口应该走HTTPS协议，并且对应的网络域名确保已经在小程序管理平台配置好</li> <li>在测试阶段不要打开小程序的调试模式进行测试，因为在调试模式下，微信不会校验域名合法性，容易导致开发者误以为测试通过，导致正式版小程序因为遇到非法域名无法正常工作。</li> <li>发布前请检查小程序使用到的网络接口已经在现网部署好，并且评估好服务器的机器负载情况。</li></ol> <h2 id="_1-搭建基本项目结构目录"><a href="#_1-搭建基本项目结构目录" aria-hidden="true" class="header-anchor">#</a> 1.搭建基本项目结构目录</h2> <h3 id="和vue学习的区别"><a href="#和vue学习的区别" aria-hidden="true" class="header-anchor">#</a> 和Vue学习的区别</h3> <ul><li>Vue不用搭建项目,直接上js文件就能写出效果, 但是小程序必须要搭建起项目, 才能看到页面效果.</li> <li>放心: 搭建项目非常简单</li> <li>搭建小程序的步骤:官网启动教程(自行百度)</li></ul> <h3 id="_1-app-json"><a href="#_1-app-json" aria-hidden="true" class="header-anchor">#</a> 1.app.json</h3> <ul><li>就这个文件<img src="/assets/img/appjson.c7091818.png" alt="效果">,包括了小程序的所有页面路径、界面表现、网络超时时间、底部 tab 等</li> <li><a href="https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/app.html" target="_blank" rel="noopener noreferrer">完整配置<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token comment">// 项目配置项</span>
<span class="token punctuation">{</span>
	<span class="token comment">//pages字段 —— 用于描述当前小程序所有页面路径, 加载有顺序的</span>
  <span class="token property">&quot;pages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;pages/index/index&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;pages/logs/index&quot;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  
	<span class="token comment">//window字段 —— 定义小程序所有页面的顶部背景颜色，文字颜色定义等</span>
  <span class="token property">&quot;window&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;navigationBarTitleText&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Demo&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;tabBar&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;list&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
      <span class="token property">&quot;pagePath&quot;</span><span class="token operator">:</span> <span class="token string">&quot;pages/index/index&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;text&quot;</span><span class="token operator">:</span> <span class="token string">&quot;首页&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;pagePath&quot;</span><span class="token operator">:</span> <span class="token string">&quot;pages/logs/logs&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;text&quot;</span><span class="token operator">:</span> <span class="token string">&quot;日志&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;networkTimeout&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;request&quot;</span><span class="token operator">:</span> <span class="token number">10000</span><span class="token punctuation">,</span>
    <span class="token property">&quot;downloadFile&quot;</span><span class="token operator">:</span> <span class="token number">10000</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;debug&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">&quot;navigateToMiniProgramAppIdList&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;wxe5f52902cf4de896&quot;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  usingComponents<span class="token operator">:</span><span class="token punctuation">{</span>  <span class="token comment">//全局自定义组件配置 配置iview等UI框架 },</span>
<span class="token punctuation">}</span>


</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><ul><li>每一个页面文件夹也有一个对应的.json文件, 可以在其中配置页面配置项</li></ul> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token comment">// 常见页面配置项</span>
<span class="token punctuation">{</span>
	<span class="token comment">// 导航条颜色</span>
  <span class="token property">&quot;navigationBarBackgroundColor&quot;</span><span class="token operator">:</span> <span class="token string">&quot;#ffffff&quot;</span><span class="token punctuation">,</span>
	<span class="token comment">// 导航字体颜色</span>
  <span class="token property">&quot;navigationBarTextStyle&quot;</span><span class="token operator">:</span> <span class="token string">&quot;black&quot;</span><span class="token punctuation">,</span>
	<span class="token comment">// 导航字体内容</span>
  <span class="token property">&quot;navigationBarTitleText&quot;</span><span class="token operator">:</span> <span class="token string">&quot;微信接口功能演示&quot;</span><span class="token punctuation">,</span>
	<span class="token comment">// 导航背景色</span>
  <span class="token property">&quot;backgroundColor&quot;</span><span class="token operator">:</span> <span class="token string">&quot;#eeeeee&quot;</span><span class="token punctuation">,</span>
	<span class="token comment">// 导航文字风格</span>
  <span class="token property">&quot;backgroundTextStyle&quot;</span><span class="token operator">:</span> <span class="token string">&quot;light&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="_2-app-js"><a href="#_2-app-js" aria-hidden="true" class="header-anchor">#</a> 2.app.js</h3> <ul><li>小程序一定要在app.js中进行初始化App(),进行注册小程序示例,绑定生命周期钩子,监听错误或不存在的页面</li> <li>App()必须有且只有调用一次, 在页面中可以使用getApp()获取全局变量等</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>app<span class="token punctuation">.</span>js
<span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	globalData<span class="token punctuation">:</span><span class="token punctuation">{</span>
		user_id<span class="token punctuation">:</span><span class="token keyword">null</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

pageA<span class="token punctuation">.</span>js
<span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token function">getApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>App<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>user_id<span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ul><li>小程序生命周期钩子
<ul><li>onLaunch  小程序初始化调用</li> <li>onShow | onHide 小程序启动或者从后台切换到前台调用</li> <li>onError | onPageNotFound 错误监听函数 和 页面不存在函数</li></ul></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code> app<span class="token punctuation">.</span>js
 
 <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	<span class="token comment">// 设置全局变量</span>
	globaleData<span class="token punctuation">:</span><span class="token punctuation">{</span>
		user_id<span class="token punctuation">:</span><span class="token keyword">null</span><span class="token punctuation">,</span>
		tel<span class="token punctuation">:</span><span class="token string">'111'</span><span class="token punctuation">,</span>
		baseUrl<span class="token punctuation">:</span><span class="token string">'???'</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	 
	<span class="token function">onLaunch</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token comment">// 小程序启动场景值获取, 场景值代表了用户是从哪种渠道进入的小程序:  只能通过onLauch和onShow获取</span>
		<span class="token comment">//如1036微信分享进入, </span>
		<span class="token comment">//1020小程序列表查找进入 , </span>
		<span class="token comment">//1043公众号推荐进入</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onStartupScen</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		<span class="token comment">//小程序自动更新,代码见官网</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	
	<span class="token function">onStartupScen</span><span class="token punctuation">(</span><span class="token parameter">query</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token comment">// 获取场景值,记录为本地用户数据</span>
		<span class="token keyword">let</span> scene <span class="token operator">=</span> query<span class="token punctuation">.</span>scene <span class="token operator">?</span> util<span class="token punctuation">.</span><span class="token function">scene_decode</span><span class="token punctuation">(</span>query<span class="token punctuation">.</span>scene<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
		<span class="token keyword">let</span> refereeId <span class="token operator">=</span> query<span class="token punctuation">.</span>refereeId <span class="token operator">?</span> query<span class="token punctuation">.</span>refereeId <span class="token punctuation">:</span> scene<span class="token punctuation">.</span>uid
		<span class="token keyword">if</span><span class="token punctuation">(</span>refereeId <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> wx<span class="token punctuation">.</span><span class="token function">setStorageSync</span><span class="token punctuation">(</span><span class="token string">'referee_id'</span> <span class="token punctuation">:</span> refereeId<span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	
	
 <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><ul><li>页面生命周期钩子
<ul><li>onLoad | onUnload 页面加载/卸载触发		! 一个页面只调用一次</li> <li>onShow | onHide 页面显示/隐藏触发		!</li> <li>onReady 页面初次渲染完成触发			!</li> <li>onPullDownRefresh  用户下拉触发		!	需要在app.json&gt;window中配置enablePullDownRefresh
<ul><li>wx.startPullDownRefresh() 自动下拉	--可用于发请求前特效</li> <li>wx.stopPullDownRefresh() 停止页面下拉--可用于数据响应结束,停止刷新操作</li></ul></li> <li>onReachBottom 	页面触底触发			!	需要在app.json&gt;window中配置触发距离: onReachBottomDistance</li> <li>onPageScroll		页面滚动触发			!</li> <li>onShareAppMessaage 右上角点击分享触发</li> <li>onResize			页面缩放触发</li></ul></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//pageA.js</span>
<span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	data<span class="token punctuation">:</span><span class="token punctuation">{</span>
		name<span class="token punctuation">:</span><span class="token string">'一个子页面数据'</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	
	<span class="token function">onLoad</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token comment">// 路径上的参数对象</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token function">onUnload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'卸载当前页面时触发'</span><span class="token punctuation">)</span><span class="token comment">// wx.redirectTo 或 wx.navigateBack到其他页面时触发</span>
	<span class="token punctuation">}</span>
	
	<span class="token function">onShow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'切入,展示当前页时触发'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token function">onHide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'隐藏当前页面时触发'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
	
	<span class="token comment">// 页面事件处理函数</span>
	<span class="token function">onPullDownRefresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'下拉刷新,注意需要配置'</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
	<span class="token function">onReachBottom</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'上拉加载更多,注意配置触底距离'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>scrollTop<span class="token punctuation">,</span>页面卷曲高度<span class="token punctuation">)</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="_3-app-wxss"><a href="#_3-app-wxss" aria-hidden="true" class="header-anchor">#</a> 3.app.wxss</h3> <ul><li>小程序公共样式表
<ul><li>设置当前程序的公共样式,</li></ul></li> <li>wxss决定wxml组件怎么显示,特性是: 新尺寸单位rpx;样式导入;
<ul><li>尺寸单位: rpx 换算时以375为基准,所以推荐设备设计稿为Iphone6</li> <li>样式导入: 使用@import 可以导入外联样式表的项目对路径, 用;结尾</li></ul></li></ul> <div class="language-css line-numbers-mode"><pre class="language-css"><code>	<span class="token atrule"><span class="token rule">@import</span> <span class="token string">'../../css/common.wxss'</span>

	.btn</span><span class="token punctuation">{</span>
		<span class="token property">width</span><span class="token punctuation">:</span>20rpx<span class="token punctuation">;</span>
		<span class="token property">height</span><span class="token punctuation">:</span>20rpx<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="_2-微信wxs模块化"><a href="#_2-微信wxs模块化" aria-hidden="true" class="header-anchor">#</a> 2.微信wxs模块化</h2> <ul><li>什么是模块化?
<ul><li>将公用代码进行抽离封装成一个单独的js文件, 如同commonjs模块化规范: 通过module.exports或exports对外暴露</li> <li>app.js就是个模块,我们可以将经常使用的数据存储在全局: App({ global:数据 })</li> <li>注意:
<ul><li>exports是modules.exprots的一个引用,更推荐使用module.exports来暴露接口.</li> <li>npm支持: 2.2.1以上基础库, 1.02以上IDE才支持npm安装:  构建npm(官方IDE-工具-构建npm-勾选)-&gt;使用npm包; 发布时要在package.json文件中设置miniprogram字段指定生成目录名</li></ul></li></ul></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//工具库 utils.js</span>
<span class="token keyword">function</span> <span class="token function">DataFormat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>DataFormat <span class="token operator">=</span> DataFormat

<span class="token comment">// 使用</span>
<span class="token keyword">const</span> utils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'/ultils.js'</span><span class="token punctuation">)</span>
utils<span class="token punctuation">.</span><span class="token function">DataFormat</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="_3-常用api-如支付-本地存储等功能"><a href="#_3-常用api-如支付-本地存储等功能" aria-hidden="true" class="header-anchor">#</a> 3.常用API(如支付,本地存储等功能)</h2> <ul><li>和js一样使用on+事件名进行监听</li></ul> <h3 id="_3-1-页面跳转-路由"><a href="#_3-1-页面跳转-路由" aria-hidden="true" class="header-anchor">#</a> 3.1 页面跳转(路由)</h3> <h4 id="_1-跳转tabbar页面-wx-switchtab"><a href="#_1-跳转tabbar页面-wx-switchtab" aria-hidden="true" class="header-anchor">#</a> 1.跳转tabBar页面 wx.switchTab({})</h4> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token comment">// app.json中</span>
<span class="token punctuation">{</span>
	<span class="token property">&quot;tabBar&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
		<span class="token property">&quot;list&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
			<span class="token punctuation">{</span>
				<span class="token property">&quot;pagePath&quot;</span><span class="token operator">:</span><span class="token string">&quot;index&quot;</span><span class="token punctuation">,</span>
				<span class="token property">&quot;text&quot;</span><span class="token operator">:</span><span class="token string">&quot;首页&quot;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token punctuation">{</span>
				<span class="token property">&quot;pagePath&quot;</span><span class="token operator">:</span><span class="token string">&quot;other&quot;</span><span class="token punctuation">,</span>
				<span class="token property">&quot;text&quot;</span><span class="token operator">:</span><span class="token string">&quot;其他&quot;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">]</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// pageA.js中</span>
<span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	<span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		wx<span class="token punctuation">.</span><span class="token function">switchTab</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			url<span class="token punctuation">:</span><span class="token string">'/index'</span> <span class="token comment">// 点击处理函数中跳转到首页TAB</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="_2-重定向页面-wx-redirectto"><a href="#_2-重定向页面-wx-redirectto" aria-hidden="true" class="header-anchor">#</a> 2.重定向页面 wx.redirectTo()</h4> <ul><li>需要跳转的应用内非 tabBar 的页面的路径, 路径后可以带参数</li> <li>参数形式'path?key=value&amp;key2=value2'</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	<span class="token comment">// 成功回调函数</span>
	<span class="token function">successHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		wx<span class="token punctuation">.</span><span class="token function">redirectTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			url<span class="token punctuation">:</span><span class="token string">'text?id=1'</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="_3-有缓存页面跳转-wx-navigateto"><a href="#_3-有缓存页面跳转-wx-navigateto" aria-hidden="true" class="header-anchor">#</a> 3.有缓存页面跳转 wx.navigateTo({})</h4> <ul><li>保留当前页面, 跳转到应用中的非tabBar页面, 保留最多10层</li> <li>可以使用wx.navigateBack进行返回</li> <li>可用于页面间数据传递</li> <li><strong>events属性</strong>: 获取被打开页面向当前页发送数据, 类似于Vue中的父组件中eventBUS
<ol><li>在当前页面navigateTo参数对象的events属性中 自定义函数</li> <li>在被跳转页面中通过EventChannel触发 传入的自定义函数,并传参 详细理解见下文<strong>页面间通信API</strong></li></ol></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 当前页 a页面中a.js</span>
wx<span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	url<span class="token punctuation">:</span><span class="token string">'test?id=1'</span><span class="token punctuation">,</span>
	events<span class="token punctuation">:</span><span class="token punctuation">{</span>	<span class="token comment">// events 值对象, 页面间通信接口</span>
		<span class="token comment">// 从已打开过的页面获取数据 自定义事件1</span>
		<span class="token function">acceptDataFromOpenedPage</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token comment">// 页面跳转成功时,触发a页面中的自定义函数, 给testjs进行传值</span>
		res<span class="token punctuation">.</span>eventChannel<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'acceptDataFromOpenedPage'</span> <span class="token punctuation">,</span> <span class="token punctuation">{</span>data<span class="token punctuation">:</span><span class="token string">'test字符串'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 被跳转到的test页的js  test.js</span>
<span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	<span class="token function">onLoad</span><span class="token punctuation">(</span><span class="token parameter">option</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		
		<span class="token keyword">let</span> _this <span class="token operator">=</span> <span class="token keyword">this</span>
		
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>option<span class="token punctuation">.</span>query<span class="token punctuation">)</span> <span class="token comment">//地址参数 { id :1  }</span>
		
		<span class="token comment">// 事件传递</span>
		<span class="token comment">// 1 获取'谁打开的页面'的页面的eventChannel</span>
		<span class="token keyword">const</span> eventChannel <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getOpennerEventChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
		<span class="token comment">// 2 监听a.js中传入的eventChannel上的函数, 接收 a页面跳转成功时emit传入的参数</span>
		eventChannel<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'acceptDataFromOpenedPage'</span> <span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			_this<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
				data
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><h4 id="页面后退-wx-navigateback"><a href="#页面后退-wx-navigateback" aria-hidden="true" class="header-anchor">#</a> 页面后退 wx.navigateBack()</h4> <h4 id="_4-打开页面-关闭其他页面-wx-relaunch"><a href="#_4-打开页面-关闭其他页面-wx-relaunch" aria-hidden="true" class="header-anchor">#</a> 4.打开页面,关闭其他页面 wx.reLaunch({})</h4> <ul><li>关闭所有页面, 打开指定页面</li> <li>可以在url属性中携带序列化字符串参数 ?k=v&amp;k=v的形式</li></ul> <h4 id="_5-页面间通信api-eventchannel"><a href="#_5-页面间通信api-eventchannel" aria-hidden="true" class="header-anchor">#</a> 5.页面间通信API: eventChannel</h4> <ul><li>理解:
<ul><li>场景: A页面跳转到B页面, 在成功时向B页面传递数据
<ol><li>方式1: 地址拼参数
<ul><li>A页面navigateTo({})跳转url拼接地址序列化字符串+B页面onLaunch中option.query获取</li></ul></li> <li>方式2: 页面自定义事件对象eventChannel
<ul><li>A页面navigateTo({})events属性自定义函数,</li> <li>B页面onLaunch中this.getOpennerEventChannel()获取自定义事件集合对象eventChannel,监听自定义函数,</li> <li>再在A页面中navigateTo的成功回调中使用emit触发自定义函数并传参就可以了</li></ul></li></ol></li></ul></li> <li>方法:
<ul><li>eventChannel.on(evenName , callback) 监听</li> <li>eventChannel.emit(evenName , dataObj) 触发</li> <li>eventChannel.off(evenName , callback) 解除监听</li></ul></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>
<span class="token comment">//APage.js</span>
<span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	data<span class="token punctuation">:</span><span class="token punctuation">{</span>
		name<span class="token punctuation">:</span><span class="token string">'123'</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token comment">// 跳转处理函数</span>
	<span class="token function">navigateHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">const</span> _this<span class="token operator">=</span><span class="token keyword">this</span>
		<span class="token comment">// 非tab页面跳转</span>
		wx<span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
		      url<span class="token punctuation">:</span> <span class="token string">&quot;/moduleC/myCode/myCode&quot;</span><span class="token punctuation">,</span>
		      events<span class="token punctuation">:</span> <span class="token punctuation">{</span>
		        <span class="token comment">// 为指定事件添加一个监听器，获取被打开页面传送到当前页面的数据</span>
		        <span class="token function-variable function">aishang</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		          <span class="token comment">//这里是获取被打开页面传送到当前页面的数据</span>
		          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'aishang'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
		        <span class="token punctuation">}</span>
		      <span class="token punctuation">}</span><span class="token punctuation">,</span>
		      <span class="token function-variable function">success</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		        <span class="token comment">// 通过eventChannel向被打开页面传送数据</span>
		        res<span class="token punctuation">.</span>eventChannel<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'aishang'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
		          data<span class="token punctuation">:</span> <span class="token string">'爱尚丽明'</span>
		        <span class="token punctuation">}</span><span class="token punctuation">)</span>
		      <span class="token punctuation">}</span>
		    <span class="token punctuation">}</span><span class="token punctuation">)</span>
		 <span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>


<span class="token comment">// B.js</span>
<span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	<span class="token function">onLaunch</span><span class="token punctuation">(</span><span class="token parameter">option</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">let</span> _this <span class="token operator">=</span> <span class="token keyword">this</span>
		<span class="token keyword">let</span> eventChannel <span class="token operator">=</span> _this<span class="token punctuation">.</span><span class="token function">getOpenerEventChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 监听aishang事件，获取上一页面通过eventChannel传送到当前页面的数据</span>
		eventChannel<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'aishang'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'传递的参数'</span><span class="token punctuation">,</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><h3 id="_3-2-定时器"><a href="#_3-2-定时器" aria-hidden="true" class="header-anchor">#</a> 3.2 定时器</h3> <ul><li>和js一样</li> <li>setInterval | setTimeout</li> <li>clearInterval | clearTimeout</li></ul> <h3 id="_3-3-网络"><a href="#_3-3-网络" aria-hidden="true" class="header-anchor">#</a> 3.3 网络</h3> <h4 id="https请求-wx-request"><a href="#https请求-wx-request" aria-hidden="true" class="header-anchor">#</a> https请求: wx.request()</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code>wx<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	url<span class="token punctuation">:</span>请求地址<span class="token punctuation">,</span>
	data<span class="token punctuation">:</span>请求参数<span class="token punctuation">,</span>
	header<span class="token punctuation">:</span><span class="token punctuation">{</span>
		content<span class="token operator">-</span>type<span class="token punctuation">:</span><span class="token string">'application/json'</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	method<span class="token punctuation">:</span>请求方式<span class="token punctuation">,</span>
	dataType<span class="token punctuation">:</span>返回数据格式<span class="token punctuation">,</span>
	responseType<span class="token punctuation">:</span>响应数据类型<span class="token punctuation">,</span>
	<span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>成功回调<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token function">fail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>失败回调<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token function">complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>请求交互结束回调<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="微信文件下载-wx-downloadfile"><a href="#微信文件下载-wx-downloadfile" aria-hidden="true" class="header-anchor">#</a> 微信文件下载: wx.downloadFile()</h4> <ul><li>客户端直接发起一个 HTTPS GET 请求，返回文件的本地临时路径，单次下载允许的最大文件为 50MB</li> <li>请在服务端响应的 header 中指定合理的 Content-Type 字段，以保证客户端正确处理文件类型</li> <li><a href="https://developers.weixin.qq.com/miniprogram/dev/api/network/download/DownloadTask.html" target="_blank" rel="noopener noreferrer">下载进度监听<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>wx<span class="token punctuation">.</span><span class="token function">downloadFile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	url<span class="token punctuation">:</span>下载资源的<span class="token constant">URL</span><span class="token punctuation">,</span>	<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>必填<span class="token punctuation">,</span>其余非必填
	header<span class="token punctuation">:</span> <span class="token punctuation">{</span>
		<span class="token constant">HTTP</span>请求Header<span class="token punctuation">,</span>不能设置Referer
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	filePath<span class="token punctuation">:</span>下载后的存储路径<span class="token punctuation">,</span>
	<span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		res<span class="token punctuation">.</span>tempFilePath 不设置请求filePath时<span class="token punctuation">,</span>请求成功本地存储的临时路径
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token function">fail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token function">complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="微信文件上传-wx-uploadfile"><a href="#微信文件上传-wx-uploadfile" aria-hidden="true" class="header-anchor">#</a> 微信文件上传: wx.uploadFile({})</h4> <ul><li>客户端发起一个 HTTPS POST 请求，其中 content-type 为 multipart/form-data</li> <li><a href="https://developers.weixin.qq.com/miniprogram/dev/api/network/upload/UploadTask.html" target="_blank" rel="noopener noreferrer">上传进度监听<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>wx<span class="token punctuation">.</span><span class="token function">uploadFile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	url<span class="token punctuation">:</span>上传地址<span class="token punctuation">,</span>
	filePath<span class="token punctuation">:</span>上传文件路径<span class="token punctuation">,</span>
	name<span class="token punctuation">:</span>文件对应的key<span class="token punctuation">,</span>服务器可以通过key获取文件的二进制内容
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//实例</span>
wx<span class="token punctuation">.</span><span class="token function">chooseImage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	<span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">const</span> tempFilePath <span class="token operator">=</span> res<span class="token punctuation">.</span>tempFilePaths
		wx<span class="token punctuation">.</span><span class="token function">uploadFile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			url<span class="token punctuation">:</span><span class="token string">&quot;上传地址&quot;</span><span class="token punctuation">,</span>
			filePath<span class="token punctuation">:</span>tempFilePaths<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
			name<span class="token punctuation">:</span><span class="token string">'filetest'</span><span class="token punctuation">,</span>
			formData<span class="token punctuation">:</span><span class="token punctuation">{</span>
				<span class="token string">'user'</span><span class="token punctuation">:</span><span class="token string">'test'</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>statusCode<span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="_3-4-页面展示效果和基本交互"><a href="#_3-4-页面展示效果和基本交互" aria-hidden="true" class="header-anchor">#</a> 3.4 页面展示效果和基本交互</h3> <h4 id="a-用户体验展示效果"><a href="#a-用户体验展示效果" aria-hidden="true" class="header-anchor">#</a> a.用户体验展示效果</h4> <ul><li>消息提示框 wx.showToast</li> <li>操作菜单 wx.showActionSheet</li> <li>模态框 wx.showModal | wx.hideModal</li> <li>加载效果 wx.showLoading | wx.hideLoading</li> <li>页面加载进度条 wx.showNavigateBarLoading | wx.hideNavigateBarLoading</li> <li>底部导航 wx.showTabBar | wx.hideTabBar</li> <li>上拉触底 wx.onReachBottom</li> <li>下拉刷新 wx.onPullDownRefresh | wx.startPullDownRefresh | wx.stopPullDownRefresh</li> <li>页面滚动至  wx.pageScrollTo</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>loading效果可以显示隐藏
app<span class="token punctuation">.</span>js中

<span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	<span class="token comment">// 封装工具函数</span>
	<span class="token function">_get</span><span class="token punctuation">(</span><span class="token parameter">url <span class="token punctuation">,</span> data <span class="token punctuation">,</span> success <span class="token punctuation">,</span> fail <span class="token punctuation">,</span> complete</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">let</span> _this <span class="token operator">=</span> <span class="token keyword">this</span>
		
		url <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>baseURL <span class="token operator">+</span> url
		data <span class="token operator">=</span> <span class="token keyword">instanceof</span> <span class="token class-name">data</span>  <span class="token operator">===</span> <span class="token string">'object'</span> <span class="token operator">?</span> data <span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
		
		<span class="token comment">//请求之前展示loading效果</span>
		wx<span class="token punctuation">.</span><span class="token function">showLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		wx<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			url<span class="token punctuation">,</span>
			data<span class="token punctuation">,</span>
			<span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token function">success</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
				<span class="token comment">// 请求成功隐藏loading</span>
				wx<span class="token punctuation">.</span><span class="token function">hideLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token function">fail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token function">fail</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				wx<span class="token punctuation">.</span><span class="token function">hideLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token function">complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token function">complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				wx<span class="token punctuation">.</span><span class="token function">hideLoding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h4 id="b-动画"><a href="#b-动画" aria-hidden="true" class="header-anchor">#</a> b.动画</h4> <ol><li>创建动画实例 wx.createAnimation({})</li> <li>给动画实例设置动画具体操作: translate , rotate , scale , step等</li> <li>给组件animation属性值变量赋值为动画实例的导出对象, this.setData({ aniamtion : myAnimation.export() })</li> <li>把实例添加给组件的animation属性</li></ol> <ul><li>(尽量将动画实例添加给当前页面实例, 为了后续修改动画操作)</li> <li>export操作会释放之前的动画队列</li></ul> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">animation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{my_animation}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>动画组件<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	
	data<span class="token punctuation">:</span><span class="token punctuation">{</span>
		my_animation<span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	
	<span class="token function">onShow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token comment">//1 创建实例</span>
		<span class="token keyword">let</span> my_animation <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">createAnimation</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			duration<span class="token punctuation">:</span><span class="token number">1500</span><span class="token punctuation">,</span>
			timingFunction<span class="token punctuation">:</span><span class="token string">'ease'</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
		
		<span class="token comment">// 1.2 将动画实例设置给本页实例,以备以后使用</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>myAniamtion <span class="token operator">=</span> my_animation
		
		<span class="token comment">//2 准备动画内容</span>
		my_animation<span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span><span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rotate</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">step</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token comment">//3 设置到元素上</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			my_animation<span class="token punctuation">:</span>my_animation<span class="token punctuation">.</span><span class="token function">export</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	
	<span class="token comment">// 在onShow中设置了动画实例之后, 后续操作中都可以修改动画序列的显示效果</span>
	<span class="token function">handleChangeAniamte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token comment">//分步骤的动画</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>myAnimation<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">step</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>myAniamtion<span class="token punctuation">.</span><span class="token function">rotate</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">step</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			my_aniamtion<span class="token punctuation">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>myAnimation<span class="token punctuation">.</span><span class="token function">export</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h4 id="c-窗口操作"><a href="#c-窗口操作" aria-hidden="true" class="header-anchor">#</a> c.窗口操作</h4> <ul><li>开启关闭 窗口尺寸调整监听: wx.onWindowResize(fn) | wx.offWindowResize(fn)</li> <li>fn的参数是重调后的尺寸大小</li></ul> <h4 id="d-键盘操作"><a href="#d-键盘操作" aria-hidden="true" class="header-anchor">#</a> d.键盘操作</h4> <ul><li>虚拟键盘隐藏  wx.hideKeyBoard(fn)</li> <li>获取选中后输入内容光标位置  wx.getSelectedTextRange(cb)</li> <li>虚拟键盘高度改变</li></ul> <h2 id="_4-数据缓存"><a href="#_4-数据缓存" aria-hidden="true" class="header-anchor">#</a> 4.数据缓存</h2> <ul><li>单个 key 允许存储的最大数据长度为 1MB，所有数据存储上限为 10MB</li></ul> <h3 id="设置缓存"><a href="#设置缓存" aria-hidden="true" class="header-anchor">#</a> 设置缓存</h3> <ul><li>wx.setStorageSync(JSON2Obj)</li> <li>wx.setStorage(JSON2Obj)</li></ul> <h3 id="清除缓存"><a href="#清除缓存" aria-hidden="true" class="header-anchor">#</a> 清除缓存</h3> <ul><li>wx.removeStorage(key)</li> <li>wx.removeStorageSync(key)</li> <li>wx.clearStorage()</li> <li>wx.clearStorageSync()</li></ul> <h3 id="获取缓存"><a href="#获取缓存" aria-hidden="true" class="header-anchor">#</a> 获取缓存</h3> <ul><li>wx.getStorageSync(stringKey)</li> <li>wx.getStorage({key:???})</li></ul> <h2 id="_5-定位"><a href="#_5-定位" aria-hidden="true" class="header-anchor">#</a> 5.定位</h2> <h3 id="前提定位权限获取"><a href="#前提定位权限获取" aria-hidden="true" class="header-anchor">#</a> 前提定位权限获取</h3> <ul><li>1: 程序加载时appjs中首先获取用户定位授权 <a href="https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/authorize.html#scope-%E5%88%97%E8%A1%A8" target="_blank" rel="noopener noreferrer">授权列表<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>2: 在app.json中配置需求定位</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token number">1</span> <span class="token comment">// app.js</span>
<span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	<span class="token comment">// 1 小程序展示时调用,获取用户授权, 获取一次可以</span>
	<span class="token function">onShow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token comment">// 2 先查找配置项中有没有授权,如果没有再展示请求</span>
		wx<span class="token punctuation">.</span><span class="token function">getSetting</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
		  <span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>res<span class="token punctuation">.</span>authSetting<span class="token punctuation">[</span><span class="token string">'scope.userLocation'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			  <span class="token comment">//3 如果没有授权过就请求授权</span>
		      wx<span class="token punctuation">.</span><span class="token function">authorize</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
		        scope<span class="token punctuation">:</span> <span class="token string">'scope.userLocation'</span><span class="token punctuation">,</span>
		        <span class="token function">success</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					wx<span class="token punctuation">.</span><span class="token function">getLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		        <span class="token punctuation">}</span>
		      <span class="token punctuation">}</span><span class="token punctuation">)</span>
		    <span class="token punctuation">}</span>
		  <span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token number">2</span> <span class="token comment">// app.json</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;pages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;pages/index/index&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;permission&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;scope.userLocation&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;desc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;你的位置信息将用于小程序位置接口的效果展示&quot;</span> <span class="token comment">// 高速公路行驶持续后台定位</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="获取用户定位-wx-getlocation"><a href="#获取用户定位-wx-getlocation" aria-hidden="true" class="header-anchor">#</a> 获取用户定位: wx.getLocation({})</h3> <ul><li>获取当前地理位置,速度. 小程序切后台无法调用</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// App.js中 程序需初始化时调用</span>
<span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	
	<span class="token function">onLaunch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">let</span> locationData <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	
	<span class="token comment">// 获取定位函数封装</span>
	<span class="token function">getLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		wx<span class="token punctuation">.</span><span class="token function">getLocation</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			type<span class="token punctuation">:</span><span class="token string">'wgs84'</span><span class="token punctuation">,</span> 	<span class="token comment">// 配置gps定位</span>
			<span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>	<span class="token comment">// 获取地理位置成功返回请求数据</span>
				<span class="token keyword">return</span> res
				<span class="token comment">/**
				 * res 中包含了 经纬,速度,高度
				 * */</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token function">fail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				wx<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
					title<span class="token punctuation">:</span><span class="token string">&quot;获取定位失败,请重试&quot;</span><span class="token punctuation">,</span>
					duration<span class="token punctuation">:</span><span class="token number">1000</span><span class="token punctuation">,</span>
					mask<span class="token punctuation">:</span><span class="token boolean">true</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h3 id="定位追踪"><a href="#定位追踪" aria-hidden="true" class="header-anchor">#</a> 定位追踪</h3> <ul><li>中文: 在位置发生改变的时候获取当前位置,并展示在地图上</li> <li>代码: wx.onLocationChange() 回调中 使用 wx.startLocationUpdate</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">_locationChangeFn</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'location change'</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
wx<span class="token punctuation">.</span><span class="token function">onLocationChange</span><span class="token punctuation">(</span>_locationChangeFn<span class="token punctuation">)</span>


<span class="token comment">// 开启后台定位服务</span>
wx<span class="token punctuation">.</span><span class="token function">startLocationUpdateBackground</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	<span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token comment">// 后台定位开启成功后,对位置改变进行监听</span>
		ws<span class="token punctuation">.</span><span class="token function">onLocationChange</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token comment">// 位置修改时触发打开位置地图</span>
			ws<span class="token punctuation">.</span><span class="token function">openLocation</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">||</span> ws<span class="token punctuation">.</span><span class="token function">chooseLocation</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h4 id="wx-onlocationchange定位发生改变触发"><a href="#wx-onlocationchange定位发生改变触发" aria-hidden="true" class="header-anchor">#</a> wx.onLocationChange	定位发生改变触发</h4> <h4 id="wx-startlocationupdatebackground-前后台均接受位置"><a href="#wx-startlocationupdatebackground-前后台均接受位置" aria-hidden="true" class="header-anchor">#</a> wx.startLocationUpdateBackground 前后台均接受位置</h4> <h4 id="wx-startlocationupdate-切入小程序获取最新定位"><a href="#wx-startlocationupdate-切入小程序获取最新定位" aria-hidden="true" class="header-anchor">#</a> wx.startLocationUpdate 切入小程序获取最新定位</h4> <h4 id="wx-stoplocationupdate-关闭监听实时位置变化，前后台都停止消息接收"><a href="#wx-stoplocationupdate-关闭监听实时位置变化，前后台都停止消息接收" aria-hidden="true" class="header-anchor">#</a> wx.stopLocationUpdate 关闭监听实时位置变化，前后台都停止消息接收</h4> <h4 id="wx-openlocation-使用微信内置地图查看位置"><a href="#wx-openlocation-使用微信内置地图查看位置" aria-hidden="true" class="header-anchor">#</a> wx.openLocation({}) 使用微信内置地图查看位置</h4> <ul><li>通过wx.getLocation() 获取到位置数据后,传参给wx.openLocation() 就可以查看实时地图了</li></ul> <h4 id="wx-chooselocation-修改地图内位置"><a href="#wx-chooselocation-修改地图内位置" aria-hidden="true" class="header-anchor">#</a> wx.chooseLocation({}) 修改地图内位置</h4> <h2 id="_6-媒体"><a href="#_6-媒体" aria-hidden="true" class="header-anchor">#</a> 6.媒体</h2> <ul><li><a href="https://developers.weixin.qq.com/miniprogram/dev/api/media/map/wx.createMapContext.html" target="_blank" rel="noopener noreferrer">视频,音频,相机,录音,地图等<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="_7-登录-支付等3方接口"><a href="#_7-登录-支付等3方接口" aria-hidden="true" class="header-anchor">#</a> 7.登录,支付等3方接口</h2> <h3 id="登录-wx-login"><a href="#登录-wx-login" aria-hidden="true" class="header-anchor">#</a> 登录 wx.Login({})</h3> <ul><li>看看<img src="/assets/img/login.52e658f9.png" alt="登录流程图"></li></ul> <ol><li>参数对象success回调参数中 获取登录临时凭证(code)</li> <li>把code发送给后台,获取用户id 和 会话秘钥</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code> <span class="token comment">//app.js中</span>
 
 <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	<span class="token function">onLaunch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">let</span> _this <span class="token operator">=</span> <span class="token keyword">this</span>
		<span class="token comment">// 小程序初始化完成进行登录</span>
		wx<span class="token punctuation">.</span><span class="token function">Login</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			<span class="token comment">// 登录成功的res中会有当前用的CODE,把CODE发给后台做加密</span>
			<span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				wx<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
					url<span class="token punctuation">:</span><span class="token string">'后台登录接口'</span><span class="token punctuation">,</span>
					data<span class="token punctuation">:</span>res<span class="token punctuation">.</span>code<span class="token punctuation">,</span>
					<span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
						<span class="token comment">// 在后台成功返回的res中有user_id 和 会话秘钥session_key, 因为本地存储不会多用户共享,可以使用Storage进行存储</span>
						_this<span class="token punctuation">.</span><span class="token function">setStorage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
							user_id<span class="token punctuation">:</span>res<span class="token punctuation">.</span>user_id<span class="token punctuation">,</span>
							session_key<span class="token punctuation">:</span>res<span class="token punctuation">.</span>session_key
						<span class="token punctuation">}</span><span class="token punctuation">)</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token function">fail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>
 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h3 id="授权"><a href="#授权" aria-hidden="true" class="header-anchor">#</a> 授权</h3> <h4 id="步骤"><a href="#步骤" aria-hidden="true" class="header-anchor">#</a> 步骤:</h4> <ol><li>查询用户是否授权过 wx.getSetting({ }) --&gt; 获取成功回调用的res.authSetting</li> <li>授权过不用管	判断res.authSetting中scope.*的值是否为true</li> <li>未授权过就要提示获取授权 调用wx.authorize(), 会立即弹窗</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 1</span>
wx<span class="token punctuation">.</span><span class="token function">getSetting</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	<span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">let</span> settings <span class="token operator">=</span> res<span class="token punctuation">.</span>authSetting <span class="token comment">//获取用户授权 </span>
		<span class="token comment">/**
		 * 用户授权数据举例 res.authSetting
		 * {
		 *   scope.userInfo:true,	用户信息
		 *   scope.userLocaation:true,	地理定位
		 *   scope.userLocationBackground: true  后台定位
		 * }
		 * 
		 * */</span>
		<span class="token comment">//2 </span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>settings<span class="token punctuation">.</span>scope<span class="token punctuation">.</span>userLocation<span class="token punctuation">)</span><span class="token punctuation">{</span>
			wx<span class="token punctuation">.</span><span class="token function">getLocation</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
				<span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{</span> res<span class="token punctuation">.</span>data <span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
		<span class="token comment">//3</span>
			wx<span class="token punctuation">.</span><span class="token function">authorize</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
				<span class="token comment">// 要获取的权限:</span>
				scope<span class="token punctuation">:</span><span class="token string">'userLocation'</span><span class="token punctuation">,</span> <span class="token comment">// userInfo,userLocation等</span>
				<span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
					wx<span class="token punctuation">.</span><span class="token function">getLocation</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
						<span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
							wx<span class="token punctuation">.</span><span class="token function">openLocation</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span><span class="token punctuation">)</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h4 id="注意事项"><a href="#注意事项" aria-hidden="true" class="header-anchor">#</a> 注意事项:</h4> <ol><li>wx.authorize({scope: &quot;scope.userInfo&quot;})，不会弹出授权窗口，请使用 <button open-type="getUserInfo"></button></li> <li>需要授权 scope.userLocation、scope.userLocationBackground 时必须配置地理位置用途说明</li></ol> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token comment">// 在 app.json中设置</span>
<span class="token punctuation">{</span>
	<span class="token property">&quot;pages&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
	<span class="token property">&quot;permission&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
		<span class="token property">&quot;scope.userLocation&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token property">&quot;desc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;你的位置信息将用于小程序位置接口的效果展示&quot;</span> <span class="token comment">// 高速公路行驶持续后台定位</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token property">&quot;scope.userLocationUpdateBackground&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
			<span class="token property">&quot;desc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;程序后台定位需要获取您后台定位权限,请前往'设置'&gt;'位置信息'&gt;勾选'使用小程序期间和离开小程序之后'&quot;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="支付-wx-requestpayment"><a href="#支付-wx-requestpayment" aria-hidden="true" class="header-anchor">#</a> 支付 wx.requestPayment({})</h3> <h4 id="公众号支付"><a href="#公众号支付" aria-hidden="true" class="header-anchor">#</a> 公众号支付:</h4> <ol><li>后台把签名啥的算出来给我们-&gt;前端拿着参数调微信pay接口,别的 啥也不用做</li> <li>调用的接口:
<ul><li>第一个接口，调用自己后台，传递订单等信息，自己后台给你返回密钥和参数，</li> <li>第二个接口给你返回二维码，你用手机扫码支付，第二个接口用socket.io连接，服务器端主动推送支付成功消息</li></ul></li></ol> <h4 id="小程序支付"><a href="#小程序支付" aria-hidden="true" class="header-anchor">#</a> 小程序支付:</h4> <h4 id="更多详细请往下看"><a href="#更多详细请往下看" aria-hidden="true" class="header-anchor">#</a> 更多详细请往下看</h4> <ul><li><a href="https://developers.weixin.qq.com/miniprogram/dev/api/open-api/payment/wx.requestPayment.html" target="_blank" rel="noopener noreferrer">官方api<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>参数属性:必填注意
<ul><li>timeStamp 	必填		时间戳</li> <li>nonceStr 		必填		随机字符串</li> <li>package 		必填		统一下单接口返回的 prepay_id 参数值</li> <li>paySign		必填		签名</li> <li>signType		非必填	签名算法(MD5或HMAC-SHA256)</li> <li>success|fail|complete		非必填</li></ul></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>wx<span class="token punctuation">.</span><span class="token function">requestPayment</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  timeStamp<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
  nonceStr<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
  <span class="token keyword">package</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
  signType<span class="token punctuation">:</span> <span class="token string">'MD5'</span><span class="token punctuation">,</span>
  paySign<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
  <span class="token function">success</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">fail</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="支付方式"><a href="#支付方式" aria-hidden="true" class="header-anchor">#</a> 支付方式:</h4> <ul><li><strong>小程序支付</strong> : 小程序支付是专门被定义使用在小程序中的支付产品。目前在小程序中能且只能使用小程序支付的方式来唤起微信支付</li> <li>Native支付 : Native支付是商户系统按微信支付协议生成支付二维码，用户再用微信“扫一扫”完成支付的模式</li> <li>付款码支付 : 付款码支付是用户展示微信钱包内的“刷卡条码/二维码”给商户系统扫描后直接完成支付的模式</li> <li>JSAPI支付 : JSAPI支付是用户在微信中打开商户的H5页面，商户在H5页面通过调用微信支付提供的JSAPI接口调起微信支付模块完成支付(微信公众号支付)</li> <li>APP支付 : APP支付又称移动端支付，是商户通过在移动端应用APP中集成开放SDK调起微信支付模块完成支付的模式。</li> <li>H5支付 : H5支付主要是在手机、ipad等移动设备中通过浏览器来唤起微信支付的支付产品。</li></ul> <h4 id="名词解释"><a href="#名词解释" aria-hidden="true" class="header-anchor">#</a> 名词解释</h4> <ul><li>签名: 商户后台和微信支付后台根据相同的密钥和算法生成一个结果，用于校验双方身份合法性。签名的算法由微信支付制定并公开，常用的签名方式有：MD5、SHA1、SHA256、HMAC等。</li> <li>Openid: 用户在小程序内的身份标识，不同小程序拥有不同的openid。
<ul><li>商户后台系统通过登录授权、支付通知、查询订单等API可获取到用户的openid。</li></ul></li></ul> <h4 id="支付接口规范"><a href="#支付接口规范" aria-hidden="true" class="header-anchor">#</a> 支付接口规范:</h4> <ul><li><strong>判断逻辑</strong>: 协议字段返回 ---&gt; 业务返回 ---&gt; 交易状态</li> <li><strong>传输方式</strong>: 为保证交易安全性，采用HTTPS传输</li> <li><strong>提交方式</strong>: post</li> <li><strong>数据格式</strong>: 请求和响应数据是XML,根节点是<xml></xml></li> <li><strong>字符编码</strong>: UTF-8</li> <li><strong>签名算法</strong>: MD5默认</li> <li><strong>签名要求</strong>: 请求和接收数据均需要校验签名,校验步骤下方<strong>支付签名校验步骤</strong></li> <li><strong>证书要求</strong>: 申请退款、撤销订单需要商户证书</li></ul> <h4 id="支付签名校验工具和步骤"><a href="#支付签名校验工具和步骤" aria-hidden="true" class="header-anchor">#</a> 支付签名校验工具和步骤:</h4> <ul><li>步骤:</li></ul> <ol><li>设所有发送或者接收到的数据为集合M，将集合M内非空参数值的参数按照参数名ASCII码从小到大排序（字典序），使用URL键值对的格式（即key1=value1&amp;key2=value2…）拼接成字符串stringA。
<ul><li>注意:
<ul><li>参数名ASCII码从小到大排序（字典序）；</li> <li>如果参数的值为空不参与签名；</li> <li>参数名区分大小写；</li> <li>验证调用返回或微信主动通知签名时，传送的sign参数不参与签名，将生成的签名与该sign值作校验</li> <li>微信接口可能增加字段，验证签名时必须支持增加的扩展字段</li></ul></li></ul></li> <li>在stringA最后拼接上key得到stringSignTemp字符串，并对stringSignTemp进行MD5运算，再将得到的字符串所有字符转换为大写，得到sign值signValue。
<ul><li>注意:
<ul><li>key设置路径：微信商户平台(pay.weixin.qq.com)--&gt;账户设置--&gt;API安全--&gt;密钥设置</li></ul></li></ul></li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//假设传送的参数如下：</span>


</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>工具:</li></ul> <ol><li>选择签名类型：MD5或HMAC-SHA256</li> <li>选择校验方式：1,XML校验 2,deeplink校验 3,自定义参数校验</li> <li>根据选择的校验方式填入对应的的XML或参数值
<ul><li>XML校验：请将提交到接口或接口返回的XML字符串原样复制到文本框中</li> <li>deeplink校验：请将生成的deeplink字符串原样复制到文本框中</li> <li>自定义参数校验：根据接口字段定义,手动填写参数名及对应值</li></ul></li> <li>点'生成签名'会按规则生成对应的sign签名字段及提供详细的生成签名过程</li></ol> <h3 id="生物认证"><a href="#生物认证" aria-hidden="true" class="header-anchor">#</a> 生物认证</h3> <h3 id="小程序跳转"><a href="#小程序跳转" aria-hidden="true" class="header-anchor">#</a> 小程序跳转</h3> <h3 id="微信登录"><a href="#微信登录" aria-hidden="true" class="header-anchor">#</a> 微信登录</h3> <h2 id="_8-画布"><a href="#_8-画布" aria-hidden="true" class="header-anchor">#</a> 8.画布</h2></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/wx/minipro/1.拿什么写小程序.html" class="prev">
          1.搭建页面结构
        </a></span> <span class="next"><a href="/wx/minipro/3.项目叨逼叨.html">
          项目叨逼叨
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.314208ec.js" defer></script><script src="/assets/js/2.3dbe4ac7.js" defer></script><script src="/assets/js/5.38464c3f.js" defer></script>
  </body>
</html>
