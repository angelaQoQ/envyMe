<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>项目叨逼叨 | 用心</title>
    <meta name="description" content="活着">
    <link rel="icon" href="./press_avatar.png">
    
    <link rel="preload" href="/assets/css/0.styles.18be6571.css" as="style"><link rel="preload" href="/assets/js/app.314208ec.js" as="script"><link rel="preload" href="/assets/js/2.3dbe4ac7.js" as="script"><link rel="preload" href="/assets/js/8.84adaaaa.js" as="script"><link rel="prefetch" href="/assets/js/10.09fa1052.js"><link rel="prefetch" href="/assets/js/11.d4f3cc01.js"><link rel="prefetch" href="/assets/js/12.845c0d45.js"><link rel="prefetch" href="/assets/js/13.3eea8c07.js"><link rel="prefetch" href="/assets/js/14.680482c3.js"><link rel="prefetch" href="/assets/js/15.0e1a4de8.js"><link rel="prefetch" href="/assets/js/16.c2b57ca6.js"><link rel="prefetch" href="/assets/js/17.f6d53abe.js"><link rel="prefetch" href="/assets/js/18.32518103.js"><link rel="prefetch" href="/assets/js/19.27feb172.js"><link rel="prefetch" href="/assets/js/20.06be6d6e.js"><link rel="prefetch" href="/assets/js/21.9e865467.js"><link rel="prefetch" href="/assets/js/22.630cda10.js"><link rel="prefetch" href="/assets/js/23.a9756b8d.js"><link rel="prefetch" href="/assets/js/24.eb4d423b.js"><link rel="prefetch" href="/assets/js/25.ab6e4013.js"><link rel="prefetch" href="/assets/js/26.6ef779c7.js"><link rel="prefetch" href="/assets/js/27.d15ed41b.js"><link rel="prefetch" href="/assets/js/28.086a9083.js"><link rel="prefetch" href="/assets/js/29.31e7789f.js"><link rel="prefetch" href="/assets/js/3.788b749c.js"><link rel="prefetch" href="/assets/js/30.78afe3a4.js"><link rel="prefetch" href="/assets/js/31.6fa1a3fc.js"><link rel="prefetch" href="/assets/js/32.31b3c7c5.js"><link rel="prefetch" href="/assets/js/33.3bd402a1.js"><link rel="prefetch" href="/assets/js/34.26464d62.js"><link rel="prefetch" href="/assets/js/35.4cd98e92.js"><link rel="prefetch" href="/assets/js/36.23ac981b.js"><link rel="prefetch" href="/assets/js/37.0b28d024.js"><link rel="prefetch" href="/assets/js/38.1fe985a9.js"><link rel="prefetch" href="/assets/js/39.6822d10c.js"><link rel="prefetch" href="/assets/js/4.14f39196.js"><link rel="prefetch" href="/assets/js/40.0ed7188a.js"><link rel="prefetch" href="/assets/js/41.6f24726d.js"><link rel="prefetch" href="/assets/js/42.54e402eb.js"><link rel="prefetch" href="/assets/js/43.54835e7c.js"><link rel="prefetch" href="/assets/js/44.df4c1b7e.js"><link rel="prefetch" href="/assets/js/45.0873fde0.js"><link rel="prefetch" href="/assets/js/46.4796fd27.js"><link rel="prefetch" href="/assets/js/47.e9efc34d.js"><link rel="prefetch" href="/assets/js/48.6a329478.js"><link rel="prefetch" href="/assets/js/49.173f63c6.js"><link rel="prefetch" href="/assets/js/5.38464c3f.js"><link rel="prefetch" href="/assets/js/50.864c3c6f.js"><link rel="prefetch" href="/assets/js/51.6a00893c.js"><link rel="prefetch" href="/assets/js/52.48b20bcd.js"><link rel="prefetch" href="/assets/js/6.e83a0ec3.js"><link rel="prefetch" href="/assets/js/7.1bd9d7d8.js"><link rel="prefetch" href="/assets/js/9.0aada2c5.js">
    <link rel="stylesheet" href="/assets/css/0.styles.18be6571.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">用心</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Js</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Js_basis/" class="nav-link">Js基础</a></li><li class="dropdown-item"><!----> <a href="/Js_Advance/" class="nav-link">Js高级</a></li><li class="dropdown-item"><!----> <a href="/Js_bugs/" class="nav-link">Js问题整理</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Vue全家桶</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue/" class="nav-link">vue</a></li><li class="dropdown-item"><!----> <a href="/vue-router/" class="nav-link">vue-router</a></li><li class="dropdown-item"><!----> <a href="/vuex/" class="nav-link">vuex</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">小程序</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/wx/minipro/1.拿什么写小程序.html" class="nav-link">小程序</a></li><li class="dropdown-item"><!----> <a href="/wx/minipub/" class="nav-link">公众号</a></li><li class="dropdown-item"><!----> <a href="/wx/wxgm/" class="nav-link">小游戏</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Js</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Js_basis/" class="nav-link">Js基础</a></li><li class="dropdown-item"><!----> <a href="/Js_Advance/" class="nav-link">Js高级</a></li><li class="dropdown-item"><!----> <a href="/Js_bugs/" class="nav-link">Js问题整理</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Vue全家桶</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue/" class="nav-link">vue</a></li><li class="dropdown-item"><!----> <a href="/vue-router/" class="nav-link">vue-router</a></li><li class="dropdown-item"><!----> <a href="/vuex/" class="nav-link">vuex</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">小程序</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/wx/minipro/1.拿什么写小程序.html" class="nav-link">小程序</a></li><li class="dropdown-item"><!----> <a href="/wx/minipub/" class="nav-link">公众号</a></li><li class="dropdown-item"><!----> <a href="/wx/wxgm/" class="nav-link">小游戏</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Js</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue-Router</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vuex</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>小程序</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/wx/minipro/4.深入理解小程序.html" class="sidebar-link">0.一小时小程序概述</a></li><li><a href="/wx/minipro/1.拿什么写小程序.html" class="sidebar-link">1.搭建页面结构</a></li><li><a href="/wx/minipro/2.怎么写功能.html" class="sidebar-link">2.怎么写功能?</a></li><li><a href="/wx/minipro/3.项目叨逼叨.html" class="active sidebar-link">项目叨逼叨</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/wx/minipro/3.项目叨逼叨.html#_1-获取用户授权" class="sidebar-link">1.获取用户授权</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/wx/minipro/3.项目叨逼叨.html#获取用户授权设置" class="sidebar-link">获取用户授权设置</a></li><li class="sidebar-sub-header"><a href="/wx/minipro/3.项目叨逼叨.html#让用户操作权限设置" class="sidebar-link">让用户操作权限设置</a></li></ul></li><li class="sidebar-sub-header"><a href="/wx/minipro/3.项目叨逼叨.html#_2-封装请求公用函数" class="sidebar-link">2.封装请求公用函数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/wx/minipro/3.项目叨逼叨.html#在app-js中封装函数" class="sidebar-link">在app.js中封装函数</a></li><li class="sidebar-sub-header"><a href="/wx/minipro/3.项目叨逼叨.html#使用" class="sidebar-link">使用</a></li><li class="sidebar-sub-header"><a href="/wx/minipro/3.项目叨逼叨.html#在app-js中封装函数-2" class="sidebar-link">在app.js中封装函数</a></li><li class="sidebar-sub-header"><a href="/wx/minipro/3.项目叨逼叨.html#使用-2" class="sidebar-link">使用</a></li></ul></li><li class="sidebar-sub-header"><a href="/wx/minipro/3.项目叨逼叨.html#_3-外卖平台商品分类" class="sidebar-link">3.外卖平台商品分类</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/wx/minipro/3.项目叨逼叨.html#显示效果" class="sidebar-link">显示效果</a></li></ul></li><li class="sidebar-sub-header"><a href="/wx/minipro/3.项目叨逼叨.html#_4-项目需求-地理定位" class="sidebar-link">4.项目需求:地理定位</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/wx/minipro/3.项目叨逼叨.html#地理定位" class="sidebar-link">地理定位</a></li></ul></li><li class="sidebar-sub-header"><a href="/wx/minipro/3.项目叨逼叨.html#_5-利用缓存提高商品列表加载速度" class="sidebar-link">5.利用缓存提高商品列表加载速度</a></li><li class="sidebar-sub-header"><a href="/wx/minipro/3.项目叨逼叨.html#_6-缓存用户登录状态session-id" class="sidebar-link">6. 缓存用户登录状态session_id</a></li><li class="sidebar-sub-header"><a href="/wx/minipro/3.项目叨逼叨.html#_7-版本号校验封装" class="sidebar-link">7. 版本号校验封装</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/wx/minipro/3.项目叨逼叨.html#使用wx-getsysteminfosync-的sdkversion-获取程序信息" class="sidebar-link">使用wx.getSystemInfoSync() 的SDKversion 获取程序信息</a></li></ul></li><li class="sidebar-sub-header"><a href="/wx/minipro/3.项目叨逼叨.html#_8-支付功能" class="sidebar-link">8. 支付功能</a></li><li class="sidebar-sub-header"><a href="/wx/minipro/3.项目叨逼叨.html#end-0-发布模式选择" class="sidebar-link">END-0.发布模式选择</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/wx/minipro/3.项目叨逼叨.html#全量发布-当点击发布之后，所有用户访问小程序时都会使用当前最新的发布版本" class="sidebar-link">全量发布: 当点击发布之后，所有用户访问小程序时都会使用当前最新的发布版本</a></li><li class="sidebar-sub-header"><a href="/wx/minipro/3.项目叨逼叨.html#分阶段发布-分不同时间段来控制部分用户使用最新的发布版本，分阶段发布我们也称为灰度发布" class="sidebar-link">分阶段发布: 分不同时间段来控制部分用户使用最新的发布版本，分阶段发布我们也称为灰度发布</a></li></ul></li><li class="sidebar-sub-header"><a href="/wx/minipro/3.项目叨逼叨.html#end-1-性能优化" class="sidebar-link">END-1.性能优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/wx/minipro/3.项目叨逼叨.html#精简代码" class="sidebar-link">精简代码</a></li><li class="sidebar-sub-header"><a href="/wx/minipro/3.项目叨逼叨.html#多用网络资源" class="sidebar-link">多用网络资源</a></li><li class="sidebar-sub-header"><a href="/wx/minipro/3.项目叨逼叨.html#注意setdata使用" class="sidebar-link">注意setData使用</a></li><li class="sidebar-sub-header"><a href="/wx/minipro/3.项目叨逼叨.html#根据情况多使用wx-redirectto操作页面栈" class="sidebar-link">根据情况多使用wx.redirectTo操作页面栈</a></li><li class="sidebar-sub-header"><a href="/wx/minipro/3.项目叨逼叨.html#控制数据通信时间" class="sidebar-link">控制数据通信时间</a></li><li class="sidebar-sub-header"><a href="/wx/minipro/3.项目叨逼叨.html#分包下载" class="sidebar-link">分包下载</a></li></ul></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="项目叨逼叨"><a href="#项目叨逼叨" aria-hidden="true" class="header-anchor">#</a> 项目叨逼叨</h1> <h2 id="_1-获取用户授权"><a href="#_1-获取用户授权" aria-hidden="true" class="header-anchor">#</a> 1.获取用户授权</h2> <ul><li>部分接口需要经过用户授权同意才能调用: camera等</li> <li>用户选择对 scope 来进行授权，当授权给一个 scope 之后，其对应的所有接口都可以直接使用</li> <li>请开发者兼容用户拒绝授权的场景</li></ul> <h3 id="获取用户授权设置"><a href="#获取用户授权设置" aria-hidden="true" class="header-anchor">#</a> 获取用户授权设置</h3> <ul><li>开发者可以使用 wx.getSetting 获取用户当前的授权状态: 返回值中只会出现小程序已经向用户请求过的权限</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>wx<span class="token punctuation">.</span><span class="token function">getSetting</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	<span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">//用户授权结果 res.authSetting</span>
		接口调用成功的回调函数
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>authSetting<span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token function">fail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		接口调用失败的回调函数
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token function">complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		接口调用结束的回调函数（调用成功、失败都会执行）
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="让用户操作权限设置"><a href="#让用户操作权限设置" aria-hidden="true" class="header-anchor">#</a> 让用户操作权限设置</h3> <ul><li>打开客户端小程序设置界面wx.openSetting, 返回用户设置的操作结果,操作同上</li></ul> <h2 id="_2-封装请求公用函数"><a href="#_2-封装请求公用函数" aria-hidden="true" class="header-anchor">#</a> 2.封装请求公用函数</h2> <ul><li>小程序请求时需要一些动态加载效果,可以封装成公共函数</li></ul> <h3 id="在app-js中封装函数"><a href="#在app-js中封装函数" aria-hidden="true" class="header-anchor">#</a> 在app.js中封装函数</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	<span class="token comment">// 设置全局数据</span>
	globalData<span class="token punctuation">:</span><span class="token punctuation">{</span>
		user_id<span class="token punctuation">:</span><span class="token keyword">null</span><span class="token punctuation">,</span>
		tel<span class="token punctuation">:</span><span class="token string">'1234567'</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	baseUrl<span class="token punctuation">:</span><span class="token string">'后台接口地址'</span><span class="token punctuation">,</span>
	<span class="token comment">// 设置请求函数</span>
	<span class="token comment">/**
	 * get函数: 请求前添加loading效果, 请求完成取消loading效果
	 * */</span>
	<span class="token function">_get</span><span class="token punctuation">(</span>
		url<span class="token punctuation">,</span><span class="token comment">// 请求地址</span>
		data<span class="token punctuation">,</span><span class="token comment">// 请求参数</span>
		success<span class="token punctuation">,</span><span class="token comment">// 成功回调</span>
		fail<span class="token punctuation">,</span><span class="token comment">// 失败回答</span>
		complete<span class="token punctuation">,</span><span class="token comment">// 完成后钩子</span>
		<span class="token comment">// checklogin// 检测登录函数 有需要可以继续追加</span>
	<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token comment">// 加载特效</span>
		wx<span class="token punctuation">.</span><span class="token function">showNavigationBarloding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">let</span> App <span class="token operator">=</span> <span class="token keyword">this</span>
		<span class="token comment">// 构造请求函数</span>
		data <span class="token operator">=</span> data <span class="token operator">|</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
		<span class="token comment">// 设置程序appid</span>
		data<span class="token punctuation">.</span>wxapp_id <span class="token operator">=</span> App<span class="token punctuation">.</span>siteInfo<span class="token punctuation">.</span>uniacid
		
		<span class="token comment">// 发送请求</span>
		wx<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			url<span class="token punctuation">:</span> App<span class="token punctuation">.</span>baseUrl <span class="token operator">+</span> url<span class="token punctuation">,</span>
			header<span class="token punctuation">:</span><span class="token punctuation">{</span>
				<span class="token string">'content-type'</span><span class="token punctuation">:</span><span class="token string">'application/json'</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			data<span class="token punctuation">:</span>data<span class="token punctuation">,</span>
			<span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token comment">/** if(res.statusCode !== 200 || typeof res.data !== 'object'){
					App.showError('网络请求错误')
					return false
				}
				if(res.data.code == -1) {// 登录失效
					wx.hideNavigationiBarLoding()
					App.doLogin()
				}else if(res.data.code === 0){// 后台处理遇到错误
					App.showError(res.data.msg , ()=&gt;{
						fail&amp;&amp;fail()
					})
				}else  */</span>
				<span class="token keyword">if</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>code <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// 成功</span>
					wx<span class="token punctuation">.</span><span class="token function">hideNavigationBarLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
					success <span class="token operator">&amp;&amp;</span> <span class="token function">success</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token function">fail</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
				App<span class="token punctuation">.</span><span class="token function">showError</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>errMsg <span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
					fail<span class="token operator">&amp;&amp;</span> <span class="token function">fail</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token function">complete</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				wx<span class="token punctuation">.</span><span class="token function">hideNavigationBarLoding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				complete<span class="token operator">&amp;&amp;</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 如果需要登录或者别的操作就执行</span>
	login<span class="token operator">&amp;&amp;</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
	
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br></div></div><h3 id="使用"><a href="#使用" aria-hidden="true" class="header-anchor">#</a> 使用</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 在 不同page的index.js中</span>
<span class="token comment">//1 引入</span>
<span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token function">getApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	<span class="token function">某些函数逻辑中</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		App<span class="token punctuation">.</span><span class="token function">_get</span><span class="token punctuation">(</span>
			地址<span class="token punctuation">,</span>
			参数<span class="token punctuation">,</span>
			各个回调
		<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="在app-js中封装函数-2"><a href="#在app-js中封装函数-2" aria-hidden="true" class="header-anchor">#</a> 在app.js中封装函数</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	<span class="token comment">// 设置全局数据</span>
	globalData<span class="token punctuation">:</span><span class="token punctuation">{</span>
		user_id<span class="token punctuation">:</span><span class="token keyword">null</span><span class="token punctuation">,</span>
		tel<span class="token punctuation">:</span><span class="token string">'1234567'</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	baseUrl<span class="token punctuation">:</span><span class="token string">'后台接口地址'</span><span class="token punctuation">,</span>
	<span class="token comment">// 设置请求函数</span>
	<span class="token comment">/**
	 * get函数: 请求前添加loading效果, 请求完成取消loading效果
	 * */</span>
	<span class="token function">_get</span><span class="token punctuation">(</span>
		url<span class="token punctuation">,</span><span class="token comment">// 请求地址</span>
		data<span class="token punctuation">,</span><span class="token comment">// 请求参数</span>
		success<span class="token punctuation">,</span><span class="token comment">// 成功回调</span>
		fail<span class="token punctuation">,</span><span class="token comment">// 失败回答</span>
		complete<span class="token punctuation">,</span><span class="token comment">// 完成后钩子</span>
		<span class="token comment">// checklogin// 检测登录函数 有需要可以继续追加</span>
	<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token comment">// 加载特效</span>
		wx<span class="token punctuation">.</span><span class="token function">showNavigationBarloding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">let</span> App <span class="token operator">=</span> <span class="token keyword">this</span>
		<span class="token comment">// 构造请求函数</span>
		data <span class="token operator">=</span> data <span class="token operator">|</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
		<span class="token comment">// 设置程序appid</span>
		data<span class="token punctuation">.</span>wxapp_id <span class="token operator">=</span> App<span class="token punctuation">.</span>siteInfo<span class="token punctuation">.</span>uniacid
		
		<span class="token comment">// 发送请求</span>
		wx<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			url<span class="token punctuation">:</span> App<span class="token punctuation">.</span>baseUrl <span class="token operator">+</span> url<span class="token punctuation">,</span>
			header<span class="token punctuation">:</span><span class="token punctuation">{</span>
				<span class="token string">'content-type'</span><span class="token punctuation">:</span><span class="token string">'application/json'</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			data<span class="token punctuation">:</span>data<span class="token punctuation">,</span>
			<span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token comment">/** if(res.statusCode !== 200 || typeof res.data !== 'object'){
					App.showError('网络请求错误')
					return false
				}
				if(res.data.code == -1) {// 登录失效
					wx.hideNavigationiBarLoding()
					App.doLogin()
				}else if(res.data.code === 0){// 后台处理遇到错误
					App.showError(res.data.msg , ()=&gt;{
						fail&amp;&amp;fail()
					})
				}else  */</span>
				<span class="token keyword">if</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>code <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// 成功</span>
					wx<span class="token punctuation">.</span><span class="token function">hideNavigationBarLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
					success <span class="token operator">&amp;&amp;</span> <span class="token function">success</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token function">fail</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
				App<span class="token punctuation">.</span><span class="token function">showError</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>errMsg <span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
					fail<span class="token operator">&amp;&amp;</span> <span class="token function">fail</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token function">complete</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				wx<span class="token punctuation">.</span><span class="token function">hideNavigationBarLoding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				complete<span class="token operator">&amp;&amp;</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 如果需要登录或者别的操作就执行</span>
	login<span class="token operator">&amp;&amp;</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
	
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br></div></div><h3 id="使用-2"><a href="#使用-2" aria-hidden="true" class="header-anchor">#</a> 使用</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 在 不同page的index.js中</span>
<span class="token comment">//1 引入</span>
<span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token function">getApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	<span class="token function">某些函数逻辑中</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		App<span class="token punctuation">.</span><span class="token function">_get</span><span class="token punctuation">(</span>
			地址<span class="token punctuation">,</span>
			参数<span class="token punctuation">,</span>
			各个回调
		<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="_3-外卖平台商品分类"><a href="#_3-外卖平台商品分类" aria-hidden="true" class="header-anchor">#</a> 3.外卖平台商品分类</h2> <h3 id="显示效果"><a href="#显示效果" aria-hidden="true" class="header-anchor">#</a> 显示效果</h3> <ul><li><img src="/assets/img/cate.6e24ec58.png" alt="显示效果"></li></ul> <h4 id="分类页中左侧大菜单-右侧菜案内容"><a href="#分类页中左侧大菜单-右侧菜案内容" aria-hidden="true" class="header-anchor">#</a> 分类页中左侧大菜单,右侧菜案内容</h4> <ul><li>结构</li></ul> <div class="language-html line-numbers-mode"><pre class="language-html"><code>  <span class="token comment">&lt;!--左侧栏--&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scroll-view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>scroll_left<span class="token punctuation">'</span></span> <span class="token attr-name">scroll-y</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>nav_left<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span> 
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>block</span> <span class="token attr-name"><span class="token namespace">wx:</span>for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{list}}<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">wx:</span>for-index</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>idx<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">wx:</span>for-item</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>itemName<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">wx:</span>key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>*this<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>  
        <span class="token comment">&lt;!--当前项的id等于item项的id，那个就是当前状态--&gt;</span>  
        <span class="token comment">&lt;!--用data-index记录这个数据在数组的下标位置，使用data-id设置每个item的id值，供打开右侧侧滑栏使用--&gt;</span>  
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>nav_left_items {{curNav == idx ? 'active' : ''}}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>switchRightTab<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-index</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{index}}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{item.id}}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{idx}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{itemName[0].name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>  
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>block</span><span class="token punctuation">&gt;</span></span>  
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scroll-view</span><span class="token punctuation">&gt;</span></span>
  
<span class="token comment">&lt;!--右侧栏--&gt;</span>
<span class="token comment">&lt;!--如果使用 scroll-into-view 属性，必须设置 scroll-view 的高度，且最好是动态获取屏幕高度 --&gt;</span>
<span class="token comment">&lt;!-- scroll-into-view 属性 值应为某子元素id（id不能以数字开头）。设置哪个方向可滚动，则在哪个方向滚动到该元素 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scroll-view</span> <span class="token attr-name">scroll-y</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>scroll_right<span class="token punctuation">&quot;</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token selector">height:</span><span class="token punctuation">{</span><span class="token punctuation">{</span>winHeight<span class="token punctuation">}</span><span class="token punctuation">}</span>px<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span> <span class="token attr-name">scroll-into-view</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{scrollTopId}}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">scroll-with-animation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>nav_right<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span> 
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>mink<span class="token punctuation">'</span></span> <span class="token attr-name"><span class="token namespace">wx:</span>for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{list}}<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">wx:</span>for-index</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>idx<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">wx:</span>for-item</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>itemName<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">wx:</span>key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>*this<span class="token punctuation">&quot;</span></span> <span class="token attr-name">bindscroll</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>scrollTop<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>minl<span class="token punctuation">'</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>{{idx}}<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>{{itemName[0].name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>block</span> <span class="token attr-name"><span class="token namespace">wx:</span>for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{itemName}}<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">wx:</span>for-index</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>idex<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">wx:</span>key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>*this<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span> 
		  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>nav_right_items<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">wx:</span>if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{idex&gt;0}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>  
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>navigator</span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>../detail/detail<span class="token punctuation">&quot;</span></span> <span class="token attr-name">hover-class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>other-navigator-hover<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
			  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>   
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{item.picture}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>image</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token punctuation">&gt;</span></span>  
				  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span><span class="token punctuation">&gt;</span></span>{{item.desc}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>  
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span> 
			  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>  
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>navigator</span><span class="token punctuation">&gt;</span></span>  
		  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>      
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>block</span><span class="token punctuation">&gt;</span></span> 
	  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token property">width</span><span class="token punctuation">:</span>100%<span class="token punctuation">;</span><span class="token property">height</span><span class="token punctuation">:</span>30rpx<span class="token punctuation">;</span><span class="token property">background</span><span class="token punctuation">:</span>#f0f4f7</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>       
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scroll-view</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><ul><li>js</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 模拟wx.request请求的后台商品分类数据</span>
<span class="token keyword">let</span> list <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./cateListData.js'</span><span class="token punctuation">)</span>

<span class="token comment">//在Page()配置项中:</span>
<span class="token comment">/**
   * 生命周期函数--监听页面初次渲染完成
   */</span>
	  <span class="token function-variable function">onReady</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">var</span> listChild1 <span class="token operator">=</span> list<span class="token punctuation">.</span>List<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token keyword">var</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
		<span class="token comment">// 获取可视区高度</span>
		wx<span class="token punctuation">.</span><span class="token function">getSystemInfo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
		  <span class="token function-variable function">success</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			that<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			  list<span class="token punctuation">:</span> listChild1<span class="token punctuation">,</span>
			  winHeight<span class="token punctuation">:</span> res<span class="token punctuation">.</span>windowHeight<span class="token punctuation">,</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
		  <span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  
  <span class="token comment">//点击左侧 tab ，右侧列表相应位置联动 置顶</span>
	<span class="token function-variable function">switchRightTab</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	  <span class="token keyword">var</span> id <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
	  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
		<span class="token comment">// 动态把获取到的 id 传给 scrollTopId</span>
		scrollTopId<span class="token punctuation">:</span> id<span class="token punctuation">,</span>
		<span class="token comment">// 左侧点击类样式</span>
		curNav<span class="token punctuation">:</span> id
	  <span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h4 id="模拟的数据"><a href="#模拟的数据" aria-hidden="true" class="header-anchor">#</a> 模拟的数据</h4> <div class="language-json line-numbers-mode"><pre class="language-json"><code>var list = <span class="token punctuation">{</span>
  <span class="token property">&quot;List&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      'A'<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span> name<span class="token operator">:</span> '白酒' <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> 'picture'<span class="token operator">:</span> '../../img/<span class="token number">55</span>ac<span class="token number">9689</span>Ncc<span class="token number">876</span>cf<span class="token number">1.</span>jpg'<span class="token punctuation">,</span> 'desc'<span class="token operator">:</span> '葡萄酒' <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> 'picture'<span class="token operator">:</span> '../../img/<span class="token number">56668</span>c<span class="token number">04</span>N<span class="token number">5</span>cb<span class="token number">325</span>b<span class="token number">7.</span>jpg'<span class="token punctuation">,</span> 'desc'<span class="token operator">:</span> '洋酒' <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> 'picture'<span class="token operator">:</span> '../../img/<span class="token number">586e055</span>eNf<span class="token number">678</span>fd<span class="token number">52.</span>png'<span class="token punctuation">,</span> 'desc'<span class="token operator">:</span> '汾酒' <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> 'picture'<span class="token operator">:</span> '../../img/<span class="token number">596</span>d<span class="token number">6</span>f<span class="token number">4</span>eNb<span class="token number">62</span>c<span class="token number">24</span>c<span class="token number">1.</span>jpg'<span class="token punctuation">,</span> 'desc'<span class="token operator">:</span> '汾酒' <span class="token punctuation">}</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      'B'<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span> name<span class="token operator">:</span> '白酒<span class="token number">1</span>' <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> 'picture'<span class="token operator">:</span> '../../img/<span class="token number">55</span>ac<span class="token number">9689</span>Ncc<span class="token number">876</span>cf<span class="token number">1.</span>jpg'<span class="token punctuation">,</span> 'desc'<span class="token operator">:</span> '葡萄酒' <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> 'picture'<span class="token operator">:</span> '../../img/<span class="token number">56668</span>c<span class="token number">04</span>N<span class="token number">5</span>cb<span class="token number">325</span>b<span class="token number">7.</span>jpg'<span class="token punctuation">,</span> 'desc'<span class="token operator">:</span> '洋酒' <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> 'picture'<span class="token operator">:</span> '../../img/<span class="token number">586e055</span>eNf<span class="token number">678</span>fd<span class="token number">52.</span>png'<span class="token punctuation">,</span> 'desc'<span class="token operator">:</span> '汾酒' <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> 'picture'<span class="token operator">:</span> '../../img/<span class="token number">596</span>d<span class="token number">6</span>f<span class="token number">4</span>eNb<span class="token number">62</span>c<span class="token number">24</span>c<span class="token number">1.</span>jpg'<span class="token punctuation">,</span> 'desc'<span class="token operator">:</span> '汾酒' <span class="token punctuation">}</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      'C'<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span> name<span class="token operator">:</span> '白酒<span class="token number">2</span>' <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> 'picture'<span class="token operator">:</span> '../../img/<span class="token number">55</span>ac<span class="token number">9689</span>Ncc<span class="token number">876</span>cf<span class="token number">1.</span>jpg'<span class="token punctuation">,</span> 'desc'<span class="token operator">:</span> '葡萄酒' <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> 'picture'<span class="token operator">:</span> '../../img/<span class="token number">56668</span>c<span class="token number">04</span>N<span class="token number">5</span>cb<span class="token number">325</span>b<span class="token number">7.</span>jpg'<span class="token punctuation">,</span> 'desc'<span class="token operator">:</span> '洋酒' <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> 'picture'<span class="token operator">:</span> '../../img/<span class="token number">586e055</span>eNf<span class="token number">678</span>fd<span class="token number">52.</span>png'<span class="token punctuation">,</span> 'desc'<span class="token operator">:</span> '汾酒' <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> 'picture'<span class="token operator">:</span> '../../img/<span class="token number">596</span>d<span class="token number">6</span>f<span class="token number">4</span>eNb<span class="token number">62</span>c<span class="token number">24</span>c<span class="token number">1.</span>jpg'<span class="token punctuation">,</span> 'desc'<span class="token operator">:</span> '汾酒' <span class="token punctuation">}</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      'D'<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span> name<span class="token operator">:</span> '白酒<span class="token number">3</span>' <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> 'picture'<span class="token operator">:</span> '../../img/<span class="token number">55</span>ac<span class="token number">9689</span>Ncc<span class="token number">876</span>cf<span class="token number">1.</span>jpg'<span class="token punctuation">,</span> 'desc'<span class="token operator">:</span> '葡萄酒' <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> 'picture'<span class="token operator">:</span> '../../img/<span class="token number">56668</span>c<span class="token number">04</span>N<span class="token number">5</span>cb<span class="token number">325</span>b<span class="token number">7.</span>jpg'<span class="token punctuation">,</span> 'desc'<span class="token operator">:</span> '洋酒' <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> 'picture'<span class="token operator">:</span> '../../img/<span class="token number">586e055</span>eNf<span class="token number">678</span>fd<span class="token number">52.</span>png'<span class="token punctuation">,</span> 'desc'<span class="token operator">:</span> '汾酒' <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> 'picture'<span class="token operator">:</span> '../../img/<span class="token number">596</span>d<span class="token number">6</span>f<span class="token number">4</span>eNb<span class="token number">62</span>c<span class="token number">24</span>c<span class="token number">1.</span>jpg'<span class="token punctuation">,</span> 'desc'<span class="token operator">:</span> '汾酒' <span class="token punctuation">}</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      'E'<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span> name<span class="token operator">:</span> '白酒<span class="token number">4</span>' <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> 'picture'<span class="token operator">:</span> '../../img/<span class="token number">55</span>ac<span class="token number">9689</span>Ncc<span class="token number">876</span>cf<span class="token number">1.</span>jpg'<span class="token punctuation">,</span> 'desc'<span class="token operator">:</span> '葡萄酒' <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> 'picture'<span class="token operator">:</span> '../../img/<span class="token number">56668</span>c<span class="token number">04</span>N<span class="token number">5</span>cb<span class="token number">325</span>b<span class="token number">7.</span>jpg'<span class="token punctuation">,</span> 'desc'<span class="token operator">:</span> '洋酒' <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> 'picture'<span class="token operator">:</span> '../../img/<span class="token number">586e055</span>eNf<span class="token number">678</span>fd<span class="token number">52.</span>png'<span class="token punctuation">,</span> 'desc'<span class="token operator">:</span> '汾酒' <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> 'picture'<span class="token operator">:</span> '../../img/<span class="token number">596</span>d<span class="token number">6</span>f<span class="token number">4</span>eNb<span class="token number">62</span>c<span class="token number">24</span>c<span class="token number">1.</span>jpg'<span class="token punctuation">,</span> 'desc'<span class="token operator">:</span> '汾酒' <span class="token punctuation">}</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      'F'<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span> name<span class="token operator">:</span> '白酒<span class="token number">5</span>' <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> 'picture'<span class="token operator">:</span> '../../img/<span class="token number">55</span>ac<span class="token number">9689</span>Ncc<span class="token number">876</span>cf<span class="token number">1.</span>jpg'<span class="token punctuation">,</span> 'desc'<span class="token operator">:</span> '葡萄酒' <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> 'picture'<span class="token operator">:</span> '../../img/<span class="token number">56668</span>c<span class="token number">04</span>N<span class="token number">5</span>cb<span class="token number">325</span>b<span class="token number">7.</span>jpg'<span class="token punctuation">,</span> 'desc'<span class="token operator">:</span> '洋酒' <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> 'picture'<span class="token operator">:</span> '../../img/<span class="token number">586e055</span>eNf<span class="token number">678</span>fd<span class="token number">52.</span>png'<span class="token punctuation">,</span> 'desc'<span class="token operator">:</span> '汾酒' <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> 'picture'<span class="token operator">:</span> '../../img/<span class="token number">596</span>d<span class="token number">6</span>f<span class="token number">4</span>eNb<span class="token number">62</span>c<span class="token number">24</span>c<span class="token number">1.</span>jpg'<span class="token punctuation">,</span> 'desc'<span class="token operator">:</span> '汾酒' <span class="token punctuation">}</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      'G'<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span> name<span class="token operator">:</span> '白酒<span class="token number">6</span>' <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> 'picture'<span class="token operator">:</span> '../../img/<span class="token number">55</span>ac<span class="token number">9689</span>Ncc<span class="token number">876</span>cf<span class="token number">1.</span>jpg'<span class="token punctuation">,</span> 'desc'<span class="token operator">:</span> '葡萄酒' <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> 'picture'<span class="token operator">:</span> '../../img/<span class="token number">56668</span>c<span class="token number">04</span>N<span class="token number">5</span>cb<span class="token number">325</span>b<span class="token number">7.</span>jpg'<span class="token punctuation">,</span> 'desc'<span class="token operator">:</span> '洋酒' <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> 'picture'<span class="token operator">:</span> '../../img/<span class="token number">586e055</span>eNf<span class="token number">678</span>fd<span class="token number">52.</span>png'<span class="token punctuation">,</span> 'desc'<span class="token operator">:</span> '汾酒' <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> 'picture'<span class="token operator">:</span> '../../img/<span class="token number">596</span>d<span class="token number">6</span>f<span class="token number">4</span>eNb<span class="token number">62</span>c<span class="token number">24</span>c<span class="token number">1.</span>jpg'<span class="token punctuation">,</span> 'desc'<span class="token operator">:</span> '汾酒' <span class="token punctuation">}</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      'H'<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span> name<span class="token operator">:</span> '白酒<span class="token number">7</span>' <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> 'picture'<span class="token operator">:</span> '../../img/<span class="token number">55</span>ac<span class="token number">9689</span>Ncc<span class="token number">876</span>cf<span class="token number">1.</span>jpg'<span class="token punctuation">,</span> 'desc'<span class="token operator">:</span> '葡萄酒' <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> 'picture'<span class="token operator">:</span> '../../img/<span class="token number">56668</span>c<span class="token number">04</span>N<span class="token number">5</span>cb<span class="token number">325</span>b<span class="token number">7.</span>jpg'<span class="token punctuation">,</span> 'desc'<span class="token operator">:</span> '洋酒' <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> 'picture'<span class="token operator">:</span> '../../img/<span class="token number">586e055</span>eNf<span class="token number">678</span>fd<span class="token number">52.</span>png'<span class="token punctuation">,</span> 'desc'<span class="token operator">:</span> '汾酒' <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> 'picture'<span class="token operator">:</span> '../../img/<span class="token number">596</span>d<span class="token number">6</span>f<span class="token number">4</span>eNb<span class="token number">62</span>c<span class="token number">24</span>c<span class="token number">1.</span>jpg'<span class="token punctuation">,</span> 'desc'<span class="token operator">:</span> '汾酒' <span class="token punctuation">}</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      'I'<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span> name<span class="token operator">:</span> '白酒<span class="token number">8</span>' <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> 'picture'<span class="token operator">:</span> '../../img/<span class="token number">55</span>ac<span class="token number">9689</span>Ncc<span class="token number">876</span>cf<span class="token number">1.</span>jpg'<span class="token punctuation">,</span> 'desc'<span class="token operator">:</span> '葡萄酒' <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> 'picture'<span class="token operator">:</span> '../../img/<span class="token number">56668</span>c<span class="token number">04</span>N<span class="token number">5</span>cb<span class="token number">325</span>b<span class="token number">7.</span>jpg'<span class="token punctuation">,</span> 'desc'<span class="token operator">:</span> '洋酒' <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> 'picture'<span class="token operator">:</span> '../../img/<span class="token number">586e055</span>eNf<span class="token number">678</span>fd<span class="token number">52.</span>png'<span class="token punctuation">,</span> 'desc'<span class="token operator">:</span> '汾酒' <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> 'picture'<span class="token operator">:</span> '../../img/<span class="token number">596</span>d<span class="token number">6</span>f<span class="token number">4</span>eNb<span class="token number">62</span>c<span class="token number">24</span>c<span class="token number">1.</span>jpg'<span class="token punctuation">,</span> 'desc'<span class="token operator">:</span> '汾酒' <span class="token punctuation">}</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      'J'<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span> name<span class="token operator">:</span> '白酒<span class="token number">9</span>' <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> 'picture'<span class="token operator">:</span> '../../img/<span class="token number">55</span>ac<span class="token number">9689</span>Ncc<span class="token number">876</span>cf<span class="token number">1.</span>jpg'<span class="token punctuation">,</span> 'desc'<span class="token operator">:</span> '葡萄酒' <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> 'picture'<span class="token operator">:</span> '../../img/<span class="token number">56668</span>c<span class="token number">04</span>N<span class="token number">5</span>cb<span class="token number">325</span>b<span class="token number">7.</span>jpg'<span class="token punctuation">,</span> 'desc'<span class="token operator">:</span> '洋酒' <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> 'picture'<span class="token operator">:</span> '../../img/<span class="token number">586e055</span>eNf<span class="token number">678</span>fd<span class="token number">52.</span>png'<span class="token punctuation">,</span> 'desc'<span class="token operator">:</span> '汾酒' <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> 'picture'<span class="token operator">:</span> '../../img/<span class="token number">596</span>d<span class="token number">6</span>f<span class="token number">4</span>eNb<span class="token number">62</span>c<span class="token number">24</span>c<span class="token number">1.</span>jpg'<span class="token punctuation">,</span> 'desc'<span class="token operator">:</span> '汾酒' <span class="token punctuation">}</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      'K'<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span> name<span class="token operator">:</span> '白酒<span class="token number">10</span>' <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> 'picture'<span class="token operator">:</span> '../../img/<span class="token number">55</span>ac<span class="token number">9689</span>Ncc<span class="token number">876</span>cf<span class="token number">1.</span>jpg'<span class="token punctuation">,</span> 'desc'<span class="token operator">:</span> '葡萄酒' <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> 'picture'<span class="token operator">:</span> '../../img/<span class="token number">56668</span>c<span class="token number">04</span>N<span class="token number">5</span>cb<span class="token number">325</span>b<span class="token number">7.</span>jpg'<span class="token punctuation">,</span> 'desc'<span class="token operator">:</span> '洋酒' <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> 'picture'<span class="token operator">:</span> '../../img/<span class="token number">586e055</span>eNf<span class="token number">678</span>fd<span class="token number">52.</span>png'<span class="token punctuation">,</span> 'desc'<span class="token operator">:</span> '汾酒' <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> 'picture'<span class="token operator">:</span> '../../img/<span class="token number">596</span>d<span class="token number">6</span>f<span class="token number">4</span>eNb<span class="token number">62</span>c<span class="token number">24</span>c<span class="token number">1.</span>jpg'<span class="token punctuation">,</span> 'desc'<span class="token operator">:</span> '汾酒' <span class="token punctuation">}</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      'L'<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span> name<span class="token operator">:</span> '白酒<span class="token number">11</span>' <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> 'picture'<span class="token operator">:</span> '../../img/<span class="token number">55</span>ac<span class="token number">9689</span>Ncc<span class="token number">876</span>cf<span class="token number">1.</span>jpg'<span class="token punctuation">,</span> 'desc'<span class="token operator">:</span> '葡萄酒' <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> 'picture'<span class="token operator">:</span> '../../img/<span class="token number">56668</span>c<span class="token number">04</span>N<span class="token number">5</span>cb<span class="token number">325</span>b<span class="token number">7.</span>jpg'<span class="token punctuation">,</span> 'desc'<span class="token operator">:</span> '洋酒' <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> 'picture'<span class="token operator">:</span> '../../img/<span class="token number">586e055</span>eNf<span class="token number">678</span>fd<span class="token number">52.</span>png'<span class="token punctuation">,</span> 'desc'<span class="token operator">:</span> '汾酒' <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> 'picture'<span class="token operator">:</span> '../../img/<span class="token number">596</span>d<span class="token number">6</span>f<span class="token number">4</span>eNb<span class="token number">62</span>c<span class="token number">24</span>c<span class="token number">1.</span>jpg'<span class="token punctuation">,</span> 'desc'<span class="token operator">:</span> '汾酒' <span class="token punctuation">}</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      'M'<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span> name<span class="token operator">:</span> '白酒<span class="token number">12</span>' <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> 'picture'<span class="token operator">:</span> '../../img/<span class="token number">55</span>ac<span class="token number">9689</span>Ncc<span class="token number">876</span>cf<span class="token number">1.</span>jpg'<span class="token punctuation">,</span> 'desc'<span class="token operator">:</span> '葡萄酒' <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> 'picture'<span class="token operator">:</span> '../../img/<span class="token number">56668</span>c<span class="token number">04</span>N<span class="token number">5</span>cb<span class="token number">325</span>b<span class="token number">7.</span>jpg'<span class="token punctuation">,</span> 'desc'<span class="token operator">:</span> '洋酒' <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> 'picture'<span class="token operator">:</span> '../../img/<span class="token number">586e055</span>eNf<span class="token number">678</span>fd<span class="token number">52.</span>png'<span class="token punctuation">,</span> 'desc'<span class="token operator">:</span> '汾酒' <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> 'picture'<span class="token operator">:</span> '../../img/<span class="token number">596</span>d<span class="token number">6</span>f<span class="token number">4</span>eNb<span class="token number">62</span>c<span class="token number">24</span>c<span class="token number">1.</span>jpg'<span class="token punctuation">,</span> 'desc'<span class="token operator">:</span> '汾酒' <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
module.exports = list;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br></div></div><h2 id="_4-项目需求-地理定位"><a href="#_4-项目需求-地理定位" aria-hidden="true" class="header-anchor">#</a> 4.项目需求:地理定位</h2> <h3 id="地理定位"><a href="#地理定位" aria-hidden="true" class="header-anchor">#</a> 地理定位</h3> <ul><li>获取用户权限
<ul><li>wx.getSetting()</li> <li>app启动时获取定位权限: wx.authorize</li> <li>如果没有获取到权限,通过wx.openSetting引导用户设置</li></ul></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 获取用户定位权限</span>
<span class="token comment">/**
 * 1. 获取用户授权信息
 * 2. 判断授权信息中有无scope.userLocation 如有其值是否为true
 * 3. 如果没有scope.userLocation 则申请定位权限
 * 4. 如果有scope.userLocation但值为false,则弹窗提示用户打开微信权限设置,开启定位服务授权
 * 5. 如果scope.userLocation值为true,直接获取当前用户定位信息
 * */</span>
<span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	
	<span class="token function">onLaunch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token comment">// 获取定位授权</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	
	<span class="token function">getLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">let</span> _this <span class="token operator">=</span> <span class="token keyword">this</span>
		<span class="token comment">// 1 </span>
		wx<span class="token punctuation">.</span><span class="token function">getSetting</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			<span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token comment">// res.authSetting是!申!请!过!的授权信息, 不是所有的授权信息</span>
				<span class="token keyword">let</span>  <span class="token operator">=</span> res<span class="token punctuation">.</span>authSetting
				
				<span class="token comment">// 2 </span>
				<span class="token comment">// 如果没有scope.userLocation授权,说明没有申请过,需要申请</span>
				<span class="token keyword">if</span><span class="token punctuation">(</span>setting<span class="token punctuation">[</span><span class="token string">'scope.userLocation'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token comment">// 首次获取定位时,系统会弹窗提示是否允许</span>
					wx<span class="token punctuation">.</span><span class="token function">getLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>setting<span class="token punctuation">[</span><span class="token string">'scope.userLocation'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
					<span class="token comment">//3</span>
					<span class="token comment">// 提示用户打开设置, 需要弹框用户交互,否则不能主动打开设置</span>
					<span class="token comment">// 可以使用wx.authorize() 或 使用模态框 wx.showModal()</span>
					wx<span class="token punctuation">.</span><span class="token function">showModal</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
						title<span class="token punctuation">:</span><span class="token string">'是否授权定位服务?'</span><span class="token punctuation">,</span>
						content<span class="token punctuation">:</span><span class="token string">'本应用需要获取您的定位服务授权, 请允许, 否则无法正常运行定位服务!'</span><span class="token punctuation">,</span>
						<span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
							<span class="token keyword">if</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>confirm<span class="token punctuation">)</span><span class="token punctuation">{</span>
								wx<span class="token punctuation">.</span><span class="token function">openSetting</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
									<span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
										<span class="token keyword">let</span> setting <span class="token operator">=</span> res<span class="token punctuation">.</span>authSetting
										<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>setting<span class="token punctuation">[</span><span class="token string">'scope.userLocation'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
											wx<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
												title<span class="token punctuation">:</span><span class="token string">'获取定位授权失败, 定位服务无法提供!'</span><span class="token punctuation">,</span>
												icon<span class="token punctuation">:</span><span class="token string">'none'</span>
											<span class="token punctuation">}</span><span class="token punctuation">)</span>
										<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
											wx<span class="token punctuation">.</span><span class="token function">getLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
										<span class="token punctuation">}</span>
									<span class="token punctuation">}</span>
								<span class="token punctuation">}</span><span class="token punctuation">)</span>
							<span class="token punctuation">}</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span><span class="token punctuation">)</span>
					
				<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
					<span class="token comment">// 5</span>
					wx<span class="token punctuation">.</span><span class="token function">getLocation</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
						<span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
							wx<span class="token punctuation">.</span><span class="token function">openLocation</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
								longtitude<span class="token punctuation">:</span>res<span class="token punctuation">.</span>longtitude<span class="token punctuation">,</span>
							<span class="token punctuation">}</span><span class="token punctuation">)</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span><span class="token punctuation">)</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br></div></div><h2 id="_5-利用缓存提高商品列表加载速度"><a href="#_5-利用缓存提高商品列表加载速度" aria-hidden="true" class="header-anchor">#</a> 5.利用缓存提高商品列表加载速度</h2> <ul><li>进入页面时从本地获取存储数据,然后再发送请求</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//page.js</span>
<span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	data<span class="token punctuation">:</span><span class="token punctuation">{</span>
		list<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	
	<span class="token function">onLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">renderList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	
	<span class="token function">renderList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">let</span> _this <span class="token operator">=</span> <span class="token keyword">this</span>
		
		<span class="token keyword">let</span> list <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">getStorageSync</span><span class="token punctuation">(</span><span class="token string">'localList'</span><span class="token punctuation">)</span>
		<span class="token comment">// 先从本地获取</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">{</span>
			_this<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
				list
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// 再发请求2次渲染</span>
		wx<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			url<span class="token punctuation">:</span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token punctuation">,</span>
			method<span class="token punctuation">:</span><span class="token string">'get'</span><span class="token punctuation">,</span>
			header<span class="token punctuation">:</span><span class="token punctuation">{</span>
				<span class="token string">'content-type'</span><span class="token punctuation">:</span><span class="token string">'application/json'</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token keyword">if</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>statusCode <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
					
					_this<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
						list<span class="token punctuation">:</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>list
					<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					
					wx<span class="token punctuation">.</span><span class="token function">setStorageSync</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
						<span class="token string">'list'</span><span class="token punctuation">:</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>list
					<span class="token punctuation">}</span><span class="token punctuation">)</span>
					
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><h2 id="_6-缓存用户登录状态session-id"><a href="#_6-缓存用户登录状态session-id" aria-hidden="true" class="header-anchor">#</a> 6. 缓存用户登录状态session_id</h2> <ul><li>用户登录页面登录成功后将小程序服务器返回的用户身份识别session_id进行本地存储同时传入全局数据中,</li> <li>第二次小程序使用时校验过期时间,更新登录状态</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//Login page.js\</span>

<span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token function">getApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	<span class="token function">onLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">let</span> _this <span class="token operator">=</span> <span class="token keyword">this</span>
		
		wx<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			<span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				wx<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
					url<span class="token punctuation">:</span><span class="token string">'???'</span><span class="token punctuation">,</span>
					data<span class="token punctuation">:</span>res<span class="token punctuation">.</span>code<span class="token punctuation">,</span>
					header<span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
					<span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
						<span class="token keyword">if</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>statusCode <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
							<span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>
								<span class="token string">'session_id'</span> <span class="token punctuation">:</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>session_id<span class="token punctuation">,</span>
								<span class="token string">'expire_time'</span> <span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">*</span> <span class="token number">24</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">1000</span>	<span class="token comment">//过期时间1天</span>
							<span class="token punctuation">}</span>
							wx<span class="token punctuation">.</span><span class="token function">setStorageSync</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
							
							App<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>session_id <span class="token operator">=</span> data<span class="token punctuation">.</span>session_id
							App<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>expire_time <span class="token operator">=</span> data<span class="token punctuation">.</span>expire_time
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>在重新打开小程序的时候，我们把上一次存储的SessionId内容取出来，恢复到内存。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//app.js程序加载时校验过期时间和session_id</span>

<span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	
	globalData<span class="token punctuation">:</span><span class="token punctuation">{</span>
		session_id<span class="token punctuation">:</span><span class="token keyword">null</span><span class="token punctuation">,</span>
		expire_time<span class="token punctuation">:</span><span class="token string">''</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	
	<span class="token function">onLaunch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">let</span> _this <span class="token operator">=</span> <span class="token keyword">this</span>
		<span class="token keyword">let</span> etime <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">getStorageSync</span><span class="token punctuation">(</span><span class="token string">'expire_time'</span><span class="token punctuation">)</span>
		<span class="token comment">// 未过期</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>etime <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>etime <span class="token operator">&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token operator">*</span><span class="token number">24</span><span class="token operator">*</span><span class="token number">3600</span><span class="token operator">*</span><span class="token number">1000</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token comment">// 更新过期时间</span>
			wx<span class="token punctuation">.</span><span class="token function">setStorageSync</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
				expire_time<span class="token punctuation">:</span> etime <span class="token operator">-</span> <span class="token number">0</span>  <span class="token operator">+</span> <span class="token number">1</span><span class="token operator">*</span><span class="token number">24</span><span class="token operator">*</span><span class="token number">3600</span><span class="token operator">*</span><span class="token number">1000</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
			
			<span class="token comment">// 全局数据赋值</span>
			_this<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>expire_time <span class="token operator">=</span> etime <span class="token operator">-</span> <span class="token number">0</span>  <span class="token operator">+</span> <span class="token number">1</span><span class="token operator">*</span><span class="token number">24</span><span class="token operator">*</span><span class="token number">3600</span><span class="token operator">*</span><span class="token number">1000</span>
			_this<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>session_id <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">getStorageSync</span><span class="token punctuation">(</span><span class="token string">'session_id'</span><span class="token punctuation">)</span>
			
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h2 id="_7-版本号校验封装"><a href="#_7-版本号校验封装" aria-hidden="true" class="header-anchor">#</a> 7. 版本号校验封装</h2> <h3 id="使用wx-getsysteminfosync-的sdkversion-获取程序信息"><a href="#使用wx-getsysteminfosync-的sdkversion-获取程序信息" aria-hidden="true" class="header-anchor">#</a> 使用wx.getSystemInfoSync() 的SDKversion 获取程序信息</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">compareVersion</span><span class="token punctuation">(</span><span class="token parameter">v1<span class="token punctuation">,</span> v2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  v1 <span class="token operator">=</span> v1<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span>
  v2 <span class="token operator">=</span> v2<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span>
  <span class="token keyword">var</span> len <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>v1<span class="token punctuation">.</span>length<span class="token punctuation">,</span> v2<span class="token punctuation">.</span>length<span class="token punctuation">)</span>

  <span class="token keyword">while</span> <span class="token punctuation">(</span>v1<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> len<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    v1<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'0'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>v2<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> len<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    v2<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'0'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> num1 <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>v1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> num2 <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>v2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>num1 <span class="token operator">&gt;</span> num2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token number">1</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>num1 <span class="token operator">&lt;</span> num2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token number">0</span>
<span class="token punctuation">}</span>

<span class="token function">compareVersion</span><span class="token punctuation">(</span><span class="token string">'1.11.0'</span><span class="token punctuation">,</span> <span class="token string">'1.9.9'</span><span class="token punctuation">)</span> <span class="token comment">// =&gt; 1 // 1表示 1.11.0比1.9.9要新</span>
<span class="token function">compareVersion</span><span class="token punctuation">(</span><span class="token string">'1.11.0'</span><span class="token punctuation">,</span> <span class="token string">'1.11.0'</span><span class="token punctuation">)</span> <span class="token comment">// =&gt; 0 // 0表示1.11.0和1.11.0是同一个版本</span>
<span class="token function">compareVersion</span><span class="token punctuation">(</span><span class="token string">'1.11.0'</span><span class="token punctuation">,</span> <span class="token string">'1.99.0'</span><span class="token punctuation">)</span> <span class="token comment">// =&gt; -1 // -1表示1.11.0比 1.99.0要老</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h2 id="_8-支付功能"><a href="#_8-支付功能" aria-hidden="true" class="header-anchor">#</a> 8. 支付功能</h2> <ul><li>在支付page中准备支付函数payOrder</li></ul> <ol><li>wx.request(应用侧后台+订单号)
<ul><li>提交订单号到应用侧服务器: 点击事件获取用户点击的时间戳, 订单id数据(订单id可以存入事件源的data-属性中,可以通过datasets获取)</li></ul></li> <li>wx.requestPayment(微信后台)
<ul><li>在成功回调用将应用侧服务器响应数据, 发送请求道微信支付接口</li></ul></li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function-variable function">payOrder</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> _this <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span> 
    <span class="token keyword">let</span> order_id <span class="token operator">=</span> _this<span class="token punctuation">.</span>data<span class="token punctuation">.</span>order_id<span class="token punctuation">;</span>  <span class="token comment">//准备订单id</span>
    <span class="token keyword">let</span> type <span class="token operator">=</span> _this<span class="token punctuation">.</span>data<span class="token punctuation">.</span>order<span class="token punctuation">.</span>ship_type<span class="token punctuation">;</span>	<span class="token comment">// 准备订单类型--我项目后台需要的数据,与当前支付功能没有直接关系</span>
	
	<span class="token comment">// 显示loading</span>
	wx<span class="token punctuation">.</span><span class="token function">showLoading</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	  title<span class="token punctuation">:</span> <span class="token string">'正在处理...'</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//params:   1, 表单提交地址; 2, 表单数据; 3,提交后的回调函数</span>
	App<span class="token punctuation">.</span><span class="token function">_post_form</span><span class="token punctuation">(</span><span class="token string">'订单提交地址'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
	  order_id	
	<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	  <span class="token comment">// 错误处理</span>
	  <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>code <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	    App<span class="token punctuation">.</span><span class="token function">showError</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	  <span class="token punctuation">}</span>
	  <span class="token comment">// 发起微信支付</span>
	  wx<span class="token punctuation">.</span><span class="token function">requestPayment</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	    timeStamp<span class="token punctuation">:</span> result<span class="token punctuation">.</span>data<span class="token punctuation">.</span>timeStamp<span class="token punctuation">,</span>		<span class="token comment">// 后台创建的订单时间戳</span>
	    nonceStr<span class="token punctuation">:</span> result<span class="token punctuation">.</span>data<span class="token punctuation">.</span>nonceStr<span class="token punctuation">,</span>			<span class="token comment">// 应用侧后台返回的随机字符串</span>
	    <span class="token keyword">package</span><span class="token punctuation">:</span> <span class="token string">'prepay_id='</span> <span class="token operator">+</span> result<span class="token punctuation">.</span>data<span class="token punctuation">.</span>prepay_id<span class="token punctuation">,</span> 
	    signType<span class="token punctuation">:</span> <span class="token string">'MD5'</span><span class="token punctuation">,</span>
	    paySign<span class="token punctuation">:</span> result<span class="token punctuation">.</span>data<span class="token punctuation">.</span>paySign<span class="token punctuation">,</span>
	    <span class="token function-variable function">success</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	      _this<span class="token punctuation">.</span><span class="token function">getOrderDetail</span><span class="token punctuation">(</span>order_id<span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token punctuation">}</span><span class="token punctuation">,</span>
	    <span class="token function-variable function">fail</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	      App<span class="token punctuation">.</span><span class="token function">showError</span><span class="token punctuation">(</span><span class="token string">'订单未支付'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token punctuation">}</span><span class="token punctuation">,</span>
	  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	  wx<span class="token punctuation">.</span><span class="token function">hideLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">// 上门自取功能, 把上面 '正在处理' 代码放入 else中即可</span>
    <span class="token comment">// let building_name = wx.getStorageSync(&quot;building_name&quot;);</span>

    <span class="token comment">/**  
	 * if (type == 1) {
      wx.showModal({
        title: '提示',
        content: `是否前往 【${building_name}】 服务中心自提`,
        success: function(sm) {
          if (sm.confirm) {
            // 显示loading
            wx.showLoading({
              title: '正在处理...',
            });
            App._post_form('user.order/pay', {
              order_id
            }, function(result) {
              if (result.code === -10) {
                App.showError(result.msg);
                return false;
              }
              // 发起微信支付
              wx.requestPayment({
                timeStamp: result.data.timeStamp,
                nonceStr: result.data.nonceStr,
                package: 'prepay_id=' + result.data.prepay_id,
                signType: 'MD5',
                paySign: result.data.paySign,
                success: function(res) {
                  _this.getOrderDetail(order_id);
                },
                fail: function() {
                  App.showError('订单未支付');
                },
              });
            }, null, function() {
              wx.hideLoading();
            });
          } else if (sm.cancel) {
            console.log('用户点击取消')
          }
        }
      })
    } else {
	*/</span>
    <span class="token comment">// }</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// App中封装的表单提交</span>
	<span class="token comment">// 小程序数据siteInfo</span>
	globalData<span class="token punctuation">:</span><span class="token punctuation">{</span>
		siteInfo<span class="token punctuation">:</span><span class="token punctuation">{</span>
			name<span class="token punctuation">:</span> <span class="token string">&quot;YDQF商城&quot;</span><span class="token punctuation">,</span>
			siteroot<span class="token punctuation">:</span> <span class="token string">&quot;https://???.com/&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 正式api</span>
			<span class="token comment">// siteroot: 'https://???.com:9696/',//测试api</span>
			uniacid<span class="token punctuation">:</span> <span class="token string">&quot;???&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 此处为商城ID, 可在超管后台-商城列表中查看</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">// post提交</span>
  <span class="token punctuation">,</span><span class="token function-variable function">_post_form</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> data<span class="token punctuation">,</span> success<span class="token punctuation">,</span> fail<span class="token punctuation">,</span> complete</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> App <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    data<span class="token punctuation">.</span>wxapp_id <span class="token operator">=</span> App<span class="token punctuation">.</span>siteInfo<span class="token punctuation">.</span>uniacid<span class="token punctuation">;</span> <span class="token comment">// 准备小程序id</span>
    data<span class="token punctuation">.</span>token <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">getStorageSync</span><span class="token punctuation">(</span><span class="token string">'token'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 准备用户登录状态 session_id</span>
    wx<span class="token punctuation">.</span><span class="token function">showNavigationBarLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// 加载进度条效果</span>
    wx<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      url<span class="token punctuation">:</span> App<span class="token punctuation">.</span>api_root <span class="token operator">+</span> url<span class="token punctuation">,</span>
      header<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">'content-type'</span><span class="token punctuation">:</span> <span class="token string">'application/x-www-form-urlencoded'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      method<span class="token punctuation">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
      data<span class="token punctuation">:</span> data<span class="token punctuation">,</span>
      <span class="token function-variable function">success</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>statusCode <span class="token operator">!==</span> <span class="token number">200</span> <span class="token operator">||</span> <span class="token keyword">typeof</span> res<span class="token punctuation">.</span>data <span class="token operator">!==</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          App<span class="token punctuation">.</span><span class="token function">showError</span><span class="token punctuation">(</span><span class="token string">'网络请求出错'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>code <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 登录态失效, 重新登录</span>
          wx<span class="token punctuation">.</span><span class="token function">hideNavigationBarLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          App<span class="token punctuation">.</span><span class="token function">doLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>code <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          App<span class="token punctuation">.</span><span class="token function">showError</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>msg<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            fail <span class="token operator">&amp;&amp;</span> <span class="token function">fail</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        success <span class="token operator">&amp;&amp;</span> <span class="token function">success</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">fail</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// console.log(res);</span>
        App<span class="token punctuation">.</span><span class="token function">showError</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>errMsg<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          fail <span class="token operator">&amp;&amp;</span> <span class="token function">fail</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">complete</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        wx<span class="token punctuation">.</span><span class="token function">hideNavigationBarLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// wx.hideLoading();</span>
        complete <span class="token operator">&amp;&amp;</span> <span class="token function">complete</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br></div></div><h2 id="end-0-发布模式选择"><a href="#end-0-发布模式选择" aria-hidden="true" class="header-anchor">#</a> END-0.发布模式选择</h2> <h3 id="全量发布-当点击发布之后，所有用户访问小程序时都会使用当前最新的发布版本"><a href="#全量发布-当点击发布之后，所有用户访问小程序时都会使用当前最新的发布版本" aria-hidden="true" class="header-anchor">#</a> 全量发布: 当点击发布之后，所有用户访问小程序时都会使用当前最新的发布版本</h3> <h3 id="分阶段发布-分不同时间段来控制部分用户使用最新的发布版本，分阶段发布我们也称为灰度发布"><a href="#分阶段发布-分不同时间段来控制部分用户使用最新的发布版本，分阶段发布我们也称为灰度发布" aria-hidden="true" class="header-anchor">#</a> 分阶段发布: 分不同时间段来控制部分用户使用最新的发布版本，分阶段发布我们也称为灰度发布</h3> <h4 id="选择-普通小程序发布时采用全量发布即可，当小程序承载的功能越来越多，使用的用户数越来越多时，采用分阶段发布是一个非常好的控制风险的办法"><a href="#选择-普通小程序发布时采用全量发布即可，当小程序承载的功能越来越多，使用的用户数越来越多时，采用分阶段发布是一个非常好的控制风险的办法" aria-hidden="true" class="header-anchor">#</a> 选择:普通小程序发布时采用全量发布即可，当小程序承载的功能越来越多，使用的用户数越来越多时，采用分阶段发布是一个非常好的控制风险的办法</h4> <h2 id="end-1-性能优化"><a href="#end-1-性能优化" aria-hidden="true" class="header-anchor">#</a> END-1.性能优化</h2> <h3 id="精简代码"><a href="#精简代码" aria-hidden="true" class="header-anchor">#</a> 精简代码</h3> <ul><li>wxml和js的代码尽量精简</li> <li>不要写不必要的标签 和 样式</li></ul> <h3 id="多用网络资源"><a href="#多用网络资源" aria-hidden="true" class="header-anchor">#</a> 多用网络资源</h3> <ul><li>减少代码量</li></ul> <h3 id="注意setdata使用"><a href="#注意setdata使用" aria-hidden="true" class="header-anchor">#</a> 注意setData使用</h3> <h4 id="在setdata的数据通信流程中，数据从逻辑层经过native层转发，传入视图层的webview，再经过一系列渲染步骤之后传入组件"><a href="#在setdata的数据通信流程中，数据从逻辑层经过native层转发，传入视图层的webview，再经过一系列渲染步骤之后传入组件" aria-hidden="true" class="header-anchor">#</a> 在setData的数据通信流程中，数据从逻辑层经过native层转发，传入视图层的WebView，再经过一系列渲染步骤之后传入组件</h4> <ul><li>减少setData使用频率: 新旧DOM树在更新时主要以setData的数据进行比对,性能开销大</li> <li>将多次setData合并到一起</li> <li>不要使用setData操作不在页面展示的数据, 通过Page下的其他对象(如:myData属性)进行操作</li> <li>原生组件----不需要关心: 使用context时，数据从逻辑层传到native层后，直接传入组件中，可以显著降低传输延迟</li></ul> <h3 id="根据情况多使用wx-redirectto操作页面栈"><a href="#根据情况多使用wx-redirectto操作页面栈" aria-hidden="true" class="header-anchor">#</a> 根据情况多使用wx.redirectTo操作页面栈</h3> <ul><li>页面展示需要经过3个过程:
<ol><li>启动一个webview</li> <li>初始化webview中的基础库</li> <li>注入wxml结构和wxss样式 等待 逻辑层数据传入, 然后渲染</li></ol></li> <li>使用wx.navigateTo推入页面栈会完整调用上面3个过程, 但是wx.redirectTo只会执行第三步操作. 可以提高性能</li></ul> <h3 id="控制数据通信时间"><a href="#控制数据通信时间" aria-hidden="true" class="header-anchor">#</a> 控制数据通信时间</h3> <h4 id="小程序有2个线程共同工作-逻辑层和渲染层-渲染层-等待-逻辑层-传入数据开始-接受数据结束-的期间就是数据通信时间"><a href="#小程序有2个线程共同工作-逻辑层和渲染层-渲染层-等待-逻辑层-传入数据开始-接受数据结束-的期间就是数据通信时间" aria-hidden="true" class="header-anchor">#</a> 小程序有2个线程共同工作: 逻辑层和渲染层, 渲染层 等待 逻辑层 <strong>传入数据开始-接受数据结束</strong> 的期间就是数据通信时间</h4> <ul><li>控制page初始化时的数据传输量: 当数据量小于64KB时通信时间会在30ms内,数据量大于64KB时会明显增加通信时间, 进而影响页面渲染</li> <li>少给元素的data-属性绑数据: 用户交互时,系统给事件处理函数的参数中会携带target和currentTarget ( 事件直接触发者 和 事件绑定者 )的data-属性值</li></ul> <h3 id="分包下载"><a href="#分包下载" aria-hidden="true" class="header-anchor">#</a> 分包下载</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//app.json中</span>

<span class="token punctuation">{</span>

	<span class="token string">&quot;pages&quot;</span><span class="token punctuation">:</span><span class="token punctuation">[</span>
		不需要分包的页面<span class="token operator">...</span>
	<span class="token punctuation">]</span><span class="token punctuation">,</span>
	
	<span class="token string">&quot;subPackages&quot;</span><span class="token punctuation">:</span><span class="token punctuation">[</span>
		<span class="token punctuation">{</span>
			<span class="token string">&quot;root&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;pageAnimal&quot;</span><span class="token punctuation">,</span>
			<span class="token string">&quot;pages&quot;</span><span class="token punctuation">:</span><span class="token punctuation">[</span>
				<span class="token string">&quot;/Animal/1&quot;</span><span class="token punctuation">,</span>
				<span class="token string">&quot;/Animal/2&quot;</span><span class="token punctuation">,</span>
				<span class="token string">&quot;/Animal/3&quot;</span>
			<span class="token punctuation">]</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		
		<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		
		<span class="token operator">...</span>
		
	<span class="token punctuation">]</span>
	
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/wx/minipro/2.怎么写功能.html" class="prev">
          2.怎么写功能?
        </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.314208ec.js" defer></script><script src="/assets/js/2.3dbe4ac7.js" defer></script><script src="/assets/js/8.84adaaaa.js" defer></script>
  </body>
</html>
